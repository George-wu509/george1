


## [邊緣偵測]直線搜查家 - Hough Transform

ref1: [[邊緣偵測]直線搜查家 - Hough Transform](https://medium.com/@bob800530/hough-transform-cf6cb8337eac)
ref2 [Hough Transform 霍夫变换](https://sikasjc.github.io/2018/04/20/Hough/)
# 理論分析

> **直線的方程式有許多種表達方式**

**1.點斜式 :**

第一種為高中所學**點斜式**，真是一個既熟悉又陌生的名詞阿!!

**y = mx +b, m=斜率, b=截距**

斜率控制直線的方向，截距控制直線的高低

**2.Hesse normal form**

Hesse normal form根據**原點到直線**的**最短距離**與**角度**，來定義一條獨一無二的直線

![](https://miro.medium.com/v2/resize:fit:318/1*5zaioCLeWxiVRrivFpsF8g.png)

其中**rho** = **原點到直線**的**最短直線距離**, **theta** = **最短直線與X軸的夾角**

> **一個點可以為無限多條直線的交點**

從左下圖可以看出來**一個點可以為無限多條直線的交點**，這些線透過x,y座標轉換到rho,theta座標後，就成了右下方的曲線

![](https://miro.medium.com/v2/resize:fit:495/0*-o4XL357c_cE5QCl.jpg)

rho_theta座標轉換

當有某一條直線可以通過多個**紅點**時，轉換後的曲線，就會有**交點，**這個**交點**的rho,theta轉換回x,y座標後，就成了一條通過多個**紅點**的線。

根據以上描述，可以推斷出來，Hough轉換就是一個**找尋rho,theta座標交點**的演算法，找到這個**交點**，**轉換回x,y座標**，就會變成一條直線了。

![](https://miro.medium.com/v2/resize:fit:493/0*JkLuL90xFe2NcdnS.jpg)

多點rho_theta座標轉換

# 影片展示

從 [Thales Sehn Körting](https://www.youtube.com/channel/UCSd_7rz5nzSnzUYbjaCXC5g)這位作者的[**Hough轉換展示影片**](https://www.youtube.com/watch?v=4zHbI-fFIlI&t=69s)中的3:33秒後可以看到實際Hough轉換的展示

Step 1: 從左上到右下依序掃描出可能經過每個點的直線，並轉換到rho, theta坐標系。

![](https://miro.medium.com/v2/resize:fit:875/1*v9CI9WnHEa7BSJMFT26QDQ.png)

Step 2: 掃描完後，挑選rho,theta中被掃過最多次的點，再將其轉換到x,y坐標系，繪製出來，就找到一條直線了

![](https://miro.medium.com/v2/resize:fit:875/1*6tgF6MHmRaxhI7bK9EUKsw.png)

### Hough 变换（Hough Transformation）概述

Hough 变换是一种经典的特征检测算法，主要用于检测图像中的几何形状（如直线、圆、椭圆等）。Hough 变换通过将几何形状检测问题转化为参数空间的投票问题，从而能够在存在噪声和不完整边缘的情况下，准确检测出特定的形状。

#### 一、Hough 变换检测直线的原理

**Hough 变换检测直线** 是最常见的应用之一。检测直线的基本思想是：在笛卡尔坐标系中，一条直线可以用方程表示为：

$y = mx + b$

其中，m是直线的斜率，b是截距。

然而，由于斜率 m 在垂直直线时会趋向无穷大，传统形式不太稳定。因此，在 Hough 变换中，通常采用极坐标形式的直线方程：

$\rho = x \cdot \cos(\theta) + y \cdot \sin(\theta)$

其中，$\rho$是从原点到直线的垂直距离，$\theta$ 是该垂线与 x-轴的夹角。

##### 详细步骤：

1. **边缘检测**：
    
    - 首先，通过边缘检测算法（如 Canny 边缘检测）提取图像中的边缘点。每个边缘点都有一个坐标 (x,y)。
2. **参数空间的变换**：
    
    - 对于每个边缘点 $(x_i, y_i)$，通过直线方程 $\rho = x_i \cdot \cos(\theta) + y_i \cdot \sin(\theta)$，将其映射到参数空间（$\rho$ 和 $\theta$）。
    - 对 $\theta$ 进行遍历（通常从 0° 到 180°），对于每一个 $\theta$，计算出相应的 ρ。这样，每个边缘点在参数空间中对应一条曲线（称为 **Hough 曲线**）。
3. **投票**：
    
    - 在参数空间中，为每条 Hough 曲线上的点进行投票。每条曲线的每个交点对应着一条直线。如果多条曲线在某个参数点交汇较多，表明图像中的许多边缘点对应于同一条直线。
4. **寻找直线**：
    
    - 通过寻找参数空间中投票数最高的点（即局部极大值点），确定直线的参数 ρ 和 θ，从而得到图像中的直线。

#### 二、Hough 变换检测圆的原理

**Hough 变换检测圆** 也是常见的应用。圆的方程为：

$(x - a)^2 + (y - b)^2 = r^2$

其中，(a, b) 是圆心坐标，r 是圆的半径。

##### 详细步骤：

1. **边缘检测**：
    
    - 和直线检测一样，首先对图像进行边缘检测，提取边缘点。
2. **参数空间的变换**：
    
    - 对每个边缘点 $(x_i, y_i)$，假设可能的半径 r，通过圆的方程确定可能的圆心 (a, b)： 
    - $\large a = x_i - r \cdot \cos(\theta)$
     $\large b = y_i - r \cdot \sin(\theta)$
    - 这样，每个边缘点会对应一个参数空间中的圆心候选点。
3. **投票**：
    
    - 在参数空间中为每个候选圆心进行投票。如果多个边缘点支持相同的圆心和半径组合，则该组合的投票数增加。
4. **寻找圆**：
    
    - 通过寻找参数空间中投票数最高的点，确定圆心和半径，进而检测出图像中的圆。

#### 三、Hough 变换的步骤

1. **图像预处理**：使用边缘检测算法（如 Canny 算法）提取图像的边缘。
2. **参数空间初始化**：为直线检测初始化 (ρ,θ)空间，为圆检测初始化 (a,b,r) 空间。
3. **投票累积**：根据几何形状的方程，将边缘点映射到参数空间，并在相应位置进行投票。
4. **寻找极大值**：通过分析参数空间中的投票数，找出局部极大值点，这些点对应图像中的几何形状。

#### 四、Hough 变换的应用

1. **直线检测**：
    
    - Hough 变换常用于检测图像中的直线，例如在车道线检测、建筑物的边缘检测中。
    - 在自动驾驶中，Hough 变换可以用于检测道路上的车道线，从而帮助车辆保持在正确的车道上。
2. **圆检测**：
    
    - Hough 变换还可用于检测图像中的圆，如在工业检测中检测出机械零件上的孔洞、螺丝等圆形结构。
    - 在生物医学成像中，Hough 变换可以用于检测细胞或其他圆形结构的轮廓。
3. **椭圆和其他形状检测**：
    
    - Hough 变换的思想可以扩展到检测椭圆或其他复杂几何形状，例如在天文学中用于检测星体轨迹、在医学中用于检测特定形状的病变。
4. **模式识别与计算机视觉**：
    
    - Hough 变换还可以用于模式识别领域，通过检测图像中的特定几何形状来识别物体或场景。
    - 在机器人视觉中，Hough 变换可以帮助机器人识别出特定的物体轮廓，从而进行抓取或避障等操作。

### 总结

Hough 变换是一种强大的几何形状检测方法，通过将形状检测问题转化为参数空间中的投票问题，能够有效应对图像中的噪声和部分形状缺失。Hough 变换被广泛应用于计算机视觉中的直线、圆、椭圆检测，尤其是在自动驾驶、工业检测、医学成像等领域具有重要意义。