
ref: [从科技视觉角度感知维度2(2D->3D)](https://zhuanlan.zhihu.com/p/9975231713)
ref: [计算摄影学专栏总目录](https://zhuanlan.zhihu.com/p/570452119)
ref: [计算机视觉之--- 相机内参与外参](https://zhuanlan.zhihu.com/p/668317571)

|                                                        |                                                      |
| ------------------------------------------------------ | ---------------------------------------------------- |
| [[Geometric transformation]]                           | 相機外參(extrinsic matrix), 相機內參(intrinsic matrix)       |
| [[###本质矩阵（Essential Matrix）和基础矩阵（Fundamental Matrix）]] | 本质矩阵是描述两个相机坐标系之间几何关系的矩阵<br>基础矩阵是描述两个相机像素坐标系之间几何关系的矩阵 |


![[coordinates.png]]

### 1. 坐標系介紹

- **世界坐標系（World Coordinate System, WCS）**：
    
    - 是一個固定的三維坐標系，用於描述場景中物體的絕對位置。
    - 坐標軸通常設置為 X_E​、Y_E​、Z_E​。
- **相機坐標系（Camera Coordinate System, CCS）**：
    
    - 以相機為原點，X_C​、Y_C​、Z_C​ 軸分別代表相機的右、下、前方向。
    - 描述相機內部的三維空間。
- **影像像素坐標系（Image Pixel Coordinate System, IPCS）**：
    
    - 以影像的左上角為原點，u 和 v 分別代表水平方向和垂直方向的像素坐標。
    - 描述二維影像中的位置。

---

### 2. 相機外參(extrinsic matrix)：旋轉矩陣與平移向量

相機的外參描述了相機坐標系相對於世界坐標系的位置和朝向，通常由旋轉矩陣 R和平移向量 t 組成。

- **旋轉矩陣（Rotation Matrix, R）**：
    
    - $3 \times 3$ 的矩陣，用於描述相機坐標系相對於世界坐標系的旋轉。
    - 滿足正交性，即 $R^T R = I$。
- **平移向量（Translation Vector, t）**：
    
    - $3 \times 1$ 的向量，用於描述相機坐標系相對於世界坐標系的平移。

#### 外參矩陣表示

外參矩陣通常表示為 [R∣t][R | t][R∣t]，將旋轉和平移結合起來，形成一個 $3 \times 4$ 的矩陣，用於將世界坐標系中的點轉換到相機坐標系。

---

### 3. 相機內參(intrinsic matrix)：內參矩陣

相機的內參描述了相機的內部光學和幾何特性，主要用於將相機坐標系中的點映射到影像像素坐標系。內參通常表示為一個 $3 \times 3$ 的矩陣 K。

#### 內參矩陣 KKK 的形式

$K = \begin{bmatrix} f_x & 0 & c_x \\ 0 & f_y & c_y \\ 0 & 0 & 1 \end{bmatrix}$

- $f_x$​、$f_y$​：焦距，表示像素單位中的焦距。通常 fx=fy=f。
- $c_x$​、$c_y$​：主點坐標，表示影像中心在像素坐標系中的位置。

#### 具體例子

假設相機的內參為：

$K = \begin{bmatrix} 1000 & 0 & 500 \\ 0 & 1000 & 500 \\ 0 & 0 & 1 \end{bmatrix}$

這表示焦距為1000像素，主點位於影像的(500, 500)像素處。

---

### 4. 坐標轉換步驟

將世界坐標系中的點 (x_E, y_E, z_E) 轉換到影像像素坐標系 (u, v)的過程包括以下幾個步驟：

1. **將世界坐標轉換到相機坐標系**
2. **將相機坐標系中的點投影到影像像素坐標系**

以下將逐步詳細說明每一步的計算過程。

---

#### 步驟1：世界坐標轉換到相機坐標系

使用外參矩陣 $[R | t]$ 將世界坐標系中的點 $P_E = [x_E, y_E, z_E]^T$ 轉換到相機坐標系 $P_C = [x_C, y_C, z_C]^T$。

計算公式：

$P_C = R \cdot P_E + t$

這可以表示為矩陣乘法：

$\huge \begin{bmatrix} x_C \\ y_C \\ z_C \end{bmatrix} = R \cdot \begin{bmatrix} x_E \\ y_E \\ z_E \end{bmatrix} + \begin{bmatrix} t_x \\ t_y \\ t_z \end{bmatrix}​$​​​

---

#### 步驟2：相機坐標系轉換到影像像素坐標系

使用內參矩陣 K 將相機坐標系中的點 $P_C = [x_C, y_C, z_C]^T$ 投影到影像像素坐標系 $p = [u, v]^T$。

計算公式：

$\huge \begin{bmatrix} u \\ v \\ 1 \end{bmatrix} = K \cdot \begin{bmatrix} x_C / z_C \\ y_C / z_C \\ 1 \end{bmatrix}​$

這可以表示為：

$\huge \begin{bmatrix} u \\ v \\ 1 \end{bmatrix} = \begin{bmatrix} f_x & 0 & c_x \\ 0 & f_y & c_y \\ 0 & 0 & 1 \end{bmatrix} \cdot \begin{bmatrix} x_C / z_C \\ y_C / z_C \\ 1 \end{bmatrix}$​

具體計算：

$\huge u = f_x \cdot \frac{x_C}{z_C} + c_x$

$\huge v = f_y \cdot \frac{y_C}{z_C} + c_y$​

---

### 5. 具體例子

假設有一個3D點在世界坐標系中的坐標為 PE=[1,2,3]TP_E = [1, 2, 3]^TPE​=[1,2,3]T，相機的內參和外參如下：

- **內參矩陣 K**：
    
    $\huge K = \begin{bmatrix} 1000 & 0 & 500 \\ 0 & 1000 & 500 \\ 0 & 0 & 1 \end{bmatrix}$
- **外參矩陣 $[R | t]$**：
    
    - **旋轉矩陣 R**： $R = \begin{bmatrix} 0.999 & 0.010 & -0.020 \\ -0.010 & 0.999 & 0.030 \\ 0.020 & -0.030 & 0.999 \end{bmatrix}$
    - **平移向量 t**：$t = \begin{bmatrix} 0.1 \\ 0.2 \\ 0.3 \end{bmatrix}$

#### 步驟1：世界坐標轉換到相機坐標系

計算 $P_C = R \cdot P_E + t$。

$R \cdot P_E = \begin{bmatrix} 0.999 & 0.010 & -0.020 \\ -0.010 & 0.999 & 0.030 \\ 0.020 & -0.030 & 0.999 \end{bmatrix} \cdot \begin{bmatrix} 1 \\ 2 \\ 3 \end{bmatrix} = \begin{bmatrix} 0.999 \cdot 1 + 0.010 \cdot 2 + (-0.020) \cdot 3 \\ -0.010 \cdot 1 + 0.999 \cdot 2 + 0.030 \cdot 3 \\ 0.020 \cdot 1 + (-0.030) \cdot 2 + 0.999 \cdot 3 \end{bmatrix} = \begin{bmatrix} 0.999 + 0.020 - 0.060 \\ -0.010 + 1.998 + 0.090 \\ 0.020 - 0.060 + 2.997 \end{bmatrix} = \begin{bmatrix} 0.959 \\ 2.078 \\ 2.957 \end{bmatrix}$

再加上平移向量 t：

$P_C = \begin{bmatrix} 0.959 \\ 2.078 \\ 2.957 \end{bmatrix} + \begin{bmatrix} 0.1 \\ 0.2 \\ 0.3 \end{bmatrix} = \begin{bmatrix} 1.059 \\ 2.278 \\ 3.257 \end{bmatrix}$

#### 步驟2：相機坐標系轉換到影像像素坐標系

計算像素坐標 (u, v)。

$u = f_x \cdot \frac{x_C}{z_C} + c_x = 1000 \cdot \frac{1.059}{3.257} + 500 \approx 1000 \cdot 0.3254 + 500 \approx 325.4 + 500 = 825.4$

$v = f_y \cdot \frac{y_C}{z_C} + c_y = 1000 \cdot \frac{2.278}{3.257} + 500 \approx 1000 \cdot 0.7000 + 500 \approx 700.0 + 500 = 1200.0$

因此，世界坐標系中的點 (1, 2, 3)轉換到影像像素坐標系中的坐標為 (u,v)≈(825.4,1200.0)。

---

### 6. 總結

將一個3D點從世界坐標系轉換到影像像素坐標系涉及以下步驟：

1. **使用外參（旋轉矩陣 R 和平移向量 t）將世界坐標系中的點轉換到相機坐標系**：
    
    $P_C = R \cdot P_E + t$
2. **使用內參矩陣 K 將相機坐標系中的點投影到影像像素坐標系**：
    
    $u = f_x \cdot \frac{x_C}{z_C} + c_x$ 
    $v = f_y \cdot \frac{y_C}{z_C} + c_y$

通過結合內參和外參，可以精確地將3D點映射到2D影像中，這在三維重建、增強現實（AR）、機器人導航等應用中具有重要意義。

---

### 附錄：公式總結

1. **外參轉換**：
    
    $P_C = R \cdot P_E + t$
2. **內參投影**：
    
    $\begin{bmatrix} u \\ v \\ 1 \end{bmatrix} = K \cdot \begin{bmatrix} \frac{x_C}{z_C} \\ \frac{y_C}{z_C} \\ 1 \end{bmatrix}​$
3. **內參矩陣 KKK**：
    
    $K = \begin{bmatrix} f_x & 0 & c_x \\ 0 & f_y & c_y \\ 0 & 0 & 1 \end{bmatrix}$
4. **外參矩陣 $[R | t]$**：
    
    $[R | t] = \begin{bmatrix} R & t \end{bmatrix}$


#### 如果在multi view multi camera系統下的3d物體的某個點(x_3d,y_3d,z_3d)在兩個camera1跟camera2在各自的影像的pixel坐标系的座標是(u1,v1)以及(u2,v2), 在已知camera1跟camera2的intrinsic matrix下, 請結合camera的內參, 外參, rotation, transition, camera pose中文一步步解釋這個到最後求得(x_3d,y_3d,z_3d)的3d reconstruction過程並具體舉例, 先不考慮dostoration.

在多视角多相机系统中，通过多个相机的二维图像坐标 (u1,v1)(u_1, v_1)(u1​,v1​) 和 (u2,v2)(u_2, v_2)(u2​,v2​)，结合相机的内参和外参，可以反推出三维点 (x3d,y3d,z3d)(x_{3d}, y_{3d}, z_{3d})(x3d​,y3d​,z3d​) 的世界坐标。这一过程称为 **三维重建** (3D Reconstruction)。以下将结合内参（Intrinsic Matrix）、外参（Extrinsic Matrix）、旋转矩阵（Rotation Matrix）、平移向量（Translation Vector）及相机姿态（Camera Pose）一步步详细说明计算过程，并通过具体例子演示。

---

### 1. 问题背景

假设一个三维点 (x3d,y3d,z3d) 在两个相机拍摄的图像上的像素坐标分别为：

- 相机1的像素坐标：(u1​,v1​)
- 相机2的像素坐标：(u2,v2)

目标：利用相机的内参矩阵和外参矩阵，计算三维点的世界坐标。

#### 已知数据

1. **相机1和相机2的内参矩阵**： 对应每个相机的焦距和主点位置（中心点）：
    
    $K_1 = \begin{bmatrix} f_{x1} & 0 & c_{x1} \\ 0 & f_{y1} & c_{y1} \\ 0 & 0 & 1 \end{bmatrix}, \quad K_2 = \begin{bmatrix} f_{x2} & 0 & c_{x2} \\ 0 & f_{y2} & c_{y2} \\ 0 & 0 & 1 \end{bmatrix}$
2. **相机1和相机2的外参矩阵**： 包含旋转矩阵 R1,R2​ 和平移向量 t1, t2：
    
    [R1∣t1],[R2∣t2][R_1 | t_1], \quad [R_2 | t_2][R1​∣t1​],[R2​∣t2​]

---

### 2. 三维重建的基本步骤

三维重建过程包括以下几个步骤：

1. **像素坐标归一化**：将像素坐标转换为归一化相机坐标。
2. **构建相机投影矩阵**：结合内参和外参，计算每个相机的投影矩阵。
3. **三角测量**：利用多个视角的几何关系，反推出三维点的坐标。

---

### 3. 详细计算过程

#### **步骤1：像素坐标归一化**

将像素坐标 (u1,v1)(u_1, v_1)(u1​,v1​) 和 (u2,v2)(u_2, v_2)(u2​,v2​) 转换为归一化相机坐标 (x1′,y1′)(x'_1, y'_1)(x1′​,y1′​) 和 (x2′,y2′)(x'_2, y'_2)(x2′​,y2′​)。

公式：

[x1′y1′1]=K1−1⋅[u1v11],[x2′y2′1]=K2−1⋅[u2v21]\begin{bmatrix} x'_1 \\ y'_1 \\ 1 \end{bmatrix} = K_1^{-1} \cdot \begin{bmatrix} u_1 \\ v_1 \\ 1 \end{bmatrix}, \quad \begin{bmatrix} x'_2 \\ y'_2 \\ 1 \end{bmatrix} = K_2^{-1} \cdot \begin{bmatrix} u_2 \\ v_2 \\ 1 \end{bmatrix}​x1′​y1′​1​​=K1−1​⋅​u1​v1​1​​,​x2′​y2′​1​​=K2−1​⋅​u2​v2​1​​

#### **步骤2：构建相机投影矩阵**

相机投影矩阵结合了内参和外参，用于将三维点映射到像素平面。

投影矩阵公式：

P1=K1⋅[R1∣t1],P2=K2⋅[R2∣t2]P_1 = K_1 \cdot [R_1 | t_1], \quad P_2 = K_2 \cdot [R_2 | t_2]P1​=K1​⋅[R1​∣t1​],P2​=K2​⋅[R2​∣t2​]

- P1P_1P1​ 和 P2P_2P2​ 的形状为 3×43 \times 43×4，表示从世界坐标系到像素平面的映射关系。

#### **步骤3：三角测量**

利用三角测量公式，从两幅图像的归一化相机坐标和投影矩阵反推出三维点。

将三维点表示为 (X,Y,Z,1)T(X, Y, Z, 1)^T(X,Y,Z,1)T，满足以下线性方程组：

[x1′P13−P11y1′P13−P12x2′P23−P21y2′P23−P22]⋅[XYZ1]=0\begin{bmatrix} x'_1 P_{13} - P_{11} \\ y'_1 P_{13} - P_{12} \\ x'_2 P_{23} - P_{21} \\ y'_2 P_{23} - P_{22} \end{bmatrix} \cdot \begin{bmatrix} X \\ Y \\ Z \\ 1 \end{bmatrix} = 0​x1′​P13​−P11​y1′​P13​−P12​x2′​P23​−P21​y2′​P23​−P22​​​⋅​XYZ1​​=0

其中，PijP_{ij}Pij​ 表示投影矩阵 P1,P2P_1, P_2P1​,P2​ 的第 iii 行第 jjj 列元素。

通过最小二乘法或奇异值分解（SVD）解该方程组，得到三维点的世界坐标 (x3d,y3d,z3d)(x_{3d}, y_{3d}, z_{3d})(x3d​,y3d​,z3d​)。

---

### 4. 具体例子

#### 输入数据

1. **像素坐标**：
    
    - 相机1：(u1,v1)=(650,480)(u_1, v_1) = (650, 480)(u1​,v1​)=(650,480)
    - 相机2：(u2,v2)=(620,500)(u_2, v_2) = (620, 500)(u2​,v2​)=(620,500)
2. **相机内参**：
    
    K1=K2=[1000050001000500001]K_1 = K_2 = \begin{bmatrix} 1000 & 0 & 500 \\ 0 & 1000 & 500 \\ 0 & 0 & 1 \end{bmatrix}K1​=K2​=​100000​010000​5005001​​
3. **相机外参**：
    
    - 相机1： [R1∣t1]=[100001000010][R_1 | t_1] = \begin{bmatrix} 1 & 0 & 0 & 0 \\ 0 & 1 & 0 & 0 \\ 0 & 0 & 1 & 0 \end{bmatrix}[R1​∣t1​]=​100​010​001​000​​
    - 相机2： [R2∣t2]=[0.866−0.5010.50.866000010][R_2 | t_2] = \begin{bmatrix} 0.866 & -0.5 & 0 & 1 \\ 0.5 & 0.866 & 0 & 0 \\ 0 & 0 & 1 & 0 \end{bmatrix}[R2​∣t2​]=​0.8660.50​−0.50.8660​001​100​​

---

#### **步骤1：像素坐标归一化**

对于相机1：

[x1′y1′1]=K1−1⋅[6504801]=[1000050001000500001]−1⋅[6504801]=[0.15−0.021]\begin{bmatrix} x'_1 \\ y'_1 \\ 1 \end{bmatrix} = K_1^{-1} \cdot \begin{bmatrix} 650 \\ 480 \\ 1 \end{bmatrix} = \begin{bmatrix} 1000 & 0 & 500 \\ 0 & 1000 & 500 \\ 0 & 0 & 1 \end{bmatrix}^{-1} \cdot \begin{bmatrix} 650 \\ 480 \\ 1 \end{bmatrix} = \begin{bmatrix} 0.15 \\ -0.02 \\ 1 \end{bmatrix}​x1′​y1′​1​​=K1−1​⋅​6504801​​=​100000​010000​5005001​​−1⋅​6504801​​=​0.15−0.021​​

对于相机2：

[x2′y2′1]=K2−1⋅[6205001]=[0.1201]\begin{bmatrix} x'_2 \\ y'_2 \\ 1 \end{bmatrix} = K_2^{-1} \cdot \begin{bmatrix} 620 \\ 500 \\ 1 \end{bmatrix} = \begin{bmatrix} 0.12 \\ 0 \\ 1 \end{bmatrix}​x2′​y2′​1​​=K2−1​⋅​6205001​​=​0.1201​​

---

#### **步骤2：构建投影矩阵**

相机1的投影矩阵：

P1=K1⋅[R1∣t1]=[1000050000100050000010]P_1 = K_1 \cdot [R_1 | t_1] = \begin{bmatrix} 1000 & 0 & 500 & 0 \\ 0 & 1000 & 500 & 0 \\ 0 & 0 & 1 & 0 \end{bmatrix}P1​=K1​⋅[R1​∣t1​]=​100000​010000​5005001​000​​

相机2的投影矩阵：

P2=K2⋅[R2∣t2]=[1000⋅0.866−1000⋅0.550010005001000⋅0.86650000010]P_2 = K_2 \cdot [R_2 | t_2] = \begin{bmatrix} 1000 \cdot 0.866 & -1000 \cdot 0.5 & 500 & 1000 \\ 500 & 1000 \cdot 0.866 & 500 & 0 \\ 0 & 0 & 1 & 0 \end{bmatrix}P2​=K2​⋅[R2​∣t2​]=​1000⋅0.8665000​−1000⋅0.51000⋅0.8660​5005001​100000​​

---

#### **步骤3：三角测量**

构建线性方程组：

[0.15⋅P13−P11−0.02⋅P13−P120.12⋅P23−P210⋅P23−P22]⋅[XYZ1]=0\begin{bmatrix} 0.15 \cdot P_{13} - P_{11} \\ -0.02 \cdot P_{13} - P_{12} \\ 0.12 \cdot P_{23} - P_{21} \\ 0 \cdot P_{23} - P_{22} \end{bmatrix} \cdot \begin{bmatrix} X \\ Y \\ Z \\ 1 \end{bmatrix} = 0​0.15⋅P13​−P11​−0.02⋅P13​−P12​0.12⋅P23​−P21​0⋅P23​−P22​​​⋅​XYZ1​​=0

通过矩阵运算解出：

[XYZ]=[1.52.04.0]\begin{bmatrix} X \\ Y \\ Z \end{bmatrix} = \begin{bmatrix} 1.5 \\ 2.0 \\ 4.0 \end{bmatrix}​XYZ​​=​1.52.04.0​​

---

### 5. 最终结果

三维点的世界坐标为：

(x3d,y3d,z3d)=(1.5,2.0,4.0)(x_{3d}, y_{3d}, z_{3d}) = (1.5, 2.0, 4.0)(x3d​,y3d​,z3d​)=(1.5,2.0,4.0)

---

### 6. 总结

从多相机的像素坐标恢复三维点的世界坐标，需要以下步骤：

1. **像素坐标归一化**：通过内参矩阵将像素坐标转换为归一化相机坐标。
2. **构建投影矩阵**：结合内参和外参描述从世界坐标到像素坐标的映射。
3. **三角测量**：利用几何关系反推出三维点坐标。

此方法假设没有镜头畸变，在实际应用中，如果存在畸变，还需要先进行畸变校正。通过此过程，可以实现高精度的三维重建，是计算机视觉和多视角三维场景理解的重要基础。


### 本质矩阵（Essential Matrix）和基础矩阵（Fundamental Matrix）



本质矩阵和基础矩阵是描述多视角多相机系统中相机几何关系的重要工具，它们在多视角几何中具有核心地位。以下将从定义、关系、计算方法及其在实际应用中的作用进行详细说明，并通过具体例子加以解释。

---

### 1. 本质矩阵和基础矩阵的定义

#### 本质矩阵（Essential Matrix, EEE）

- **定义**： 本质矩阵是描述两个相机坐标系之间几何关系的矩阵。它将一个相机坐标系中的点映射到另一个相机坐标系中。

- **公式**：       $\huge p_2^T \cdot E \cdot p_1 = 0$ 

- 其中：
    - $\huge p_1 = [x_{C1}, y_{C1}, 1]^T$：相机1中的点在归一化相机坐标系中的坐标。
    - $\huge p_2 = [x_{C2}, y_{C2}, 1]^T$：相机2中的点在归一化相机坐标系中的坐标。
    
- **计算公式**： $\huge E = [t]_\times \cdot R$ 其中：
    - R：两个相机之间的旋转矩阵。
    - t：两个相机之间的平移向量。
    - $[t]_\times$​：平移向量 t 的反对称矩阵： $[t]_\times = \begin{bmatrix} 0 & -t_z & t_y \\ t_z & 0 & -t_x \\ -t_y & t_x & 0 \end{bmatrix}$

#### 基础矩阵（Fundamental Matrix, FFF）

- **定义**： 基础矩阵是描述两个相机像素坐标系之间几何关系的矩阵。它直接将一个相机的像素坐标映射到另一个相机的像素坐标。

- **公式**： $\huge p_2^T \cdot F \cdot p_1 = 0$ 

- 其中：
    - $\huge p_1 = [u_1, v_1, 1]^T$：相机1中的像素坐标。
    - $\huge p_2 = [u_2, v_2, 1]^T$：相机2中的像素坐标。
    
- **计算公式**： $\huge F = K_2^{-T} \cdot E \cdot K_1^{-1}$​ 

- 其中：
    - K1,K2​：相机1和相机2的内参矩阵。

---

### 2. 本质矩阵和基础矩阵的关系

1. **相机内参的影响**：
    
    - 本质矩阵 EEE 是在归一化相机坐标系下定义的，与相机的内参无关。
    - 基础矩阵 FFF 则依赖于相机的内参矩阵 K1K_1K1​ 和 K2K_2K2​，通过以下公式从本质矩阵计算： F=K2−T⋅E⋅K1−1F = K_2^{-T} \cdot E \cdot K_1^{-1}F=K2−T​⋅E⋅K1−1​
2. **描述的几何关系**：
    
    - 本质矩阵 EEE 描述的是两个相机的相对姿态（旋转和平移），在相机坐标系中有效。
    - 基础矩阵 FFF 描述的是两个相机的像素坐标之间的关系，直接应用于图像上的点匹配。
3. **数据输入的不同**：
    
    - 本质矩阵作用于归一化相机坐标 (xC,yC)(x_C, y_C)(xC​,yC​)。
    - 基础矩阵作用于像素坐标 (u,v)(u, v)(u,v)。

---

### 3. 应用场景

1. **点的对极约束**：
    
    - 对于本质矩阵： p2T⋅E⋅p1=0p_2^T \cdot E \cdot p_1 = 0p2T​⋅E⋅p1​=0 这表示在归一化相机坐标系中，点 p1p_1p1​ 和 p2p_2p2​ 满足对极几何关系。
    - 对于基础矩阵： p2T⋅F⋅p1=0p_2^T \cdot F \cdot p_1 = 0p2T​⋅F⋅p1​=0 这表示在像素坐标系中，点 p1p_1p1​ 和 p2p_2p2​ 满足对极几何关系。
2. **从图像匹配到三维重建**：
    
    - 使用基础矩阵 FFF 可以从像素坐标约束中推导归一化相机坐标。
    - 使用本质矩阵 EEE 可以恢复相机的相对姿态（旋转和平移）。
3. **相机标定和校正**：
    
    - 通过本质矩阵 EEE 和基础矩阵 FFF，可以计算相机的内参和外参，进而实现多视角标定。

---

### 4. 具体例子

#### 已知数据

1. **相机内参矩阵**：
    
    K1=K2=[1000050001000500001]K_1 = K_2 = \begin{bmatrix} 1000 & 0 & 500 \\ 0 & 1000 & 500 \\ 0 & 0 & 1 \end{bmatrix}K1​=K2​=​100000​010000​5005001​​
2. **相机外参矩阵**：
    
    - 相机1： [R1∣t1]=[100001000010][R_1 | t_1] = \begin{bmatrix} 1 & 0 & 0 & 0 \\ 0 & 1 & 0 & 0 \\ 0 & 0 & 1 & 0 \end{bmatrix}[R1​∣t1​]=​100​010​001​000​​
    - 相机2： [R2∣t2]=[0.866−0.5010.50.866000010][R_2 | t_2] = \begin{bmatrix} 0.866 & -0.5 & 0 & 1 \\ 0.5 & 0.866 & 0 & 0 \\ 0 & 0 & 1 & 0 \end{bmatrix}[R2​∣t2​]=​0.8660.50​−0.50.8660​001​100​​
3. **像素坐标**：
    
    - 相机1：(u1,v1)=(650,480)(u_1, v_1) = (650, 480)(u1​,v1​)=(650,480)
    - 相机2：(u2,v2)=(620,500)(u_2, v_2) = (620, 500)(u2​,v2​)=(620,500)

---

#### 步骤1：计算本质矩阵 EEE

1. **旋转矩阵 RRR**：
    
    R=R2⋅R1T=[0.866−0.500.50.8660001]R = R_2 \cdot R_1^T = \begin{bmatrix} 0.866 & -0.5 & 0 \\ 0.5 & 0.866 & 0 \\ 0 & 0 & 1 \end{bmatrix}R=R2​⋅R1T​=​0.8660.50​−0.50.8660​001​​
2. **平移向量 ttt**：
    
    t=t2−R⋅t1=[100]t = t_2 - R \cdot t_1 = \begin{bmatrix} 1 \\ 0 \\ 0 \end{bmatrix}t=t2​−R⋅t1​=​100​​
3. **平移反对称矩阵 [t]×[t]_\times[t]×​**：
    
    [t]×=[00000−1010][t]_\times = \begin{bmatrix} 0 & 0 & 0 \\ 0 & 0 & -1 \\ 0 & 1 & 0 \end{bmatrix}[t]×​=​000​001​0−10​​
4. **计算 E=[t]×⋅RE = [t]_\times \cdot RE=[t]×​⋅R**：
    
    E=[00000−1010]⋅[0.866−0.500.50.8660001]=[000−100010]E = \begin{bmatrix} 0 & 0 & 0 \\ 0 & 0 & -1 \\ 0 & 1 & 0 \end{bmatrix} \cdot \begin{bmatrix} 0.866 & -0.5 & 0 \\ 0.5 & 0.866 & 0 \\ 0 & 0 & 1 \end{bmatrix} = \begin{bmatrix} 0 & 0 & 0 \\ -1 & 0 & 0 \\ 0 & 1 & 0 \end{bmatrix}E=​000​001​0−10​​⋅​0.8660.50​−0.50.8660​001​​=​0−10​001​000​​

---

#### 步骤2：计算基础矩阵 FFF

1. **公式 F=K2−T⋅E⋅K1−1F = K_2^{-T} \cdot E \cdot K_1^{-1}F=K2−T​⋅E⋅K1−1​**： F=[0.0010−0.5−0.00100.8660.5−0.8660]F = \begin{bmatrix} 0.001 & 0 & -0.5 \\ -0.001 & 0 & 0.866 \\ 0.5 & -0.866 & 0 \end{bmatrix}F=​0.001−0.0010.5​00−0.866​−0.50.8660​​

---

### 5. 总结

1. **本质矩阵 E**：
    
    - 描述两个相机在归一化相机坐标系下的几何关系。
    - 只依赖相机的旋转和平移。
2. **基础矩阵 F**：
    
    - 描述两个相机在像素坐标系下的几何关系。
    - 依赖于相机的内参和本质矩阵。
3. **关系**：
    
    F=K2−T⋅E⋅K1−1F = K_2^{-T} \cdot E \cdot K_1^{-1}F=K2−T​⋅E⋅K1−1​
4. **应用**：
    
    - 基础矩阵用于像素匹配和对极几何约束。
    - 本质矩阵用于恢复相机的相对姿态（旋转和平移）。
    - 两者结合用于三维重建和多相机标定。

通过本质矩阵和基础矩阵的配合，可以实现多相机系统中三维点的高效重建，是计算机视觉领域的核心工具之一。

