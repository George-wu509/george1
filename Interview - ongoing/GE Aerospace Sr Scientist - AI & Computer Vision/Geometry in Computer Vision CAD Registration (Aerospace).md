

針對「智慧製造與品質檢測」應用中，我們來深入探討「電腦視覺中的幾何學 (Geometry in Computer Vision)」和「CAD 配準 (CAD Registration)」這兩個關鍵部分，包含常用的具體技術、細節、設定以及範例說明。

在航空航太製造領域，零件的幾何精度至關重要，任何微小的偏差都可能影響性能甚至安全。因此，利用電腦視覺技術精確測量和比對零件的 3D 幾何形狀是品質檢測的核心環節。

---

### 1. 電腦視覺中的幾何學 (Geometry in Computer Vision) 於品質檢測的應用

這部分著重於從感測器數據（主要是 3D 掃描數據，如點雲或網格模型）中提取、表示和分析零件的幾何資訊，以進行尺寸測量、特徵識別和形狀評估。

**目標：**

- 從掃描數據中重建零件的精確 3D 幾何模型。
- 識別和定位關鍵的幾何特徵（如平面、孔洞、邊緣、圓柱、曲面）。
- 進行高精度的尺寸量測（長度、角度、直徑、輪廓度、平面度等）。
- 評估表面品質和檢測幾何偏差。

**常用技術與細節：**

- **a) 3D 數據獲取與表示 (3D Data Acquisition & Representation):**
    
    - **技術:**
        - <mark style="background: #BBFABBA6;">**結構光掃描 (Structured Light Scanning)</mark>:** 透過投射特定光學圖案（如條紋、格點）到物體表面，並用相機捕捉變形的圖案，利用三角測量原理計算出物體表面的 3D 座標。這是目前工業檢測中精度較高且常用的技術之一。
        - <mark style="background: #BBFABBA6;">**雷射三角測量 (Laser Triangulation):**</mark> 使用雷射線或點光源掃描物體，相機從不同角度捕捉雷射在物體上的位置，同樣基於三角測量計算 3D 點位。適用於快速掃描和高精度測量。
        - <mark style="background: #BBFABBA6;">**攝影測量 / 運動恢復結構 (Photogrammetry / Structure from Motion - SfM)</mark>:** 從不同視角拍攝的多張 2D 照片中，通過匹配特徵點來推算相機位置和物體 3D 結構。適用於大型物件，但精度可能不如主動掃描技術，且需要精確的尺度標定。
    - **數據表示:** 獲取的原始數據通常是 **點雲 (Point Cloud)**，即大量 3D 座標點的集合 (x, y, z)，有時也包含法向量或顏色資訊。<mark style="background: #ADCCFFA6;">點雲可以進一步處理成 **網格模型 (Mesh Model)**</mark>，通常是三角網格，能更好地表示物體表面拓撲關係。
    - **設定考量:** 掃描解析度（點距）、掃描精度、掃描範圍、環境光線影響（對結構光）、物體表面材質（反光或透明表面可能需要特殊處理）。
- **b) 幾何特徵提取 (Geometric Feature Extraction):**
    
    - **技術:**
        - <mark style="background: #BBFABBA6;">**平面擬合 (Plane Fitting)</mark>:** 從點雲中識別並擬合出平面區域。
            - **常用方法:** **<mark style="background: #ADCCFFA6;">RANSAC (Random Sample Consensus - 隨機抽樣一致性)</mark>**。
            - **細節:** RANSAC 透過隨機選取最小點集（平面需要 3 點）來假設一個模型（平面方程），然後計算數據集中有多少點（內點 Inliers）與該模型足夠接近（在一個距離閾值內），重複此過程多次，選取擁有最多內點的模型作為最佳擬合。
            - **設定:** **距離閾值 (Distance Threshold)** - 定義點到平面的最大允許距離才算內點，需根據點雲密度和預期精度設定；**迭代次數 (Number of Iterations)** - 確保有足夠高的機率找到好的模型；**內點數量閾值 (Minimum Inlier Count)** - 接受模型所需的最少內點數。
        - **邊緣檢測 (Edge Detection):** 識別物體輪廓或不同表面交界處的邊緣線。
            - **常用方法:** <mark style="background: #ADCCFFA6;">分析點雲法向量或曲率的劇烈變化區域</mark>。可以計算每個點鄰域內點的法向量或主曲率，變化大的地方即可能是邊緣。
            - **設定:** 鄰域大小 (Neighborhood Size) - 用於計算局部特徵（如法向量、曲率）的點範圍；變化量閾值 (Change Threshold) - 定義多大的法向量夾角或曲率變化被視為邊緣。
        - **基本幾何體擬合 (Primitive Fitting - Cylinder, Sphere, Cone, etc.):** 從<mark style="background: #ADCCFFA6;">點雲中識別和擬合標準幾何形狀，如圓柱（用於孔洞、軸）、球體等</mark>。
            - **常用方法:** 同樣常使用 RANSAC 或其變體。例如，擬合圓柱需要隨機選取點來定義圓柱軸線和半徑。
            - **設定:** 類似平面擬合，需要距離閾值、迭代次數，以及可能需要對幾何體的參數（如半徑範圍）進行約束。
        - **曲率分析 (Curvature Analysis):** <mark style="background: #ADCCFFA6;">計算點雲表面上每個點的高斯曲率 (Gaussian Curvature) 和平均曲率 (Mean Curvature)</mark>。這有助於識別彎曲、圓角（Fillet）、凹陷或凸起等細微表面特徵及缺陷。
            - **設定:** 計算曲率所需的鄰域大小。
- **c) 幾何量測 (Geometric Measurement):**
    
    - **技術:** 在提取的幾何特徵（點、線、面、擬合體）基礎上，計算尺寸和公差。
        - **距離:** 點到點、點到線、點到面、線到線、面到面之間的距離（最小、最大、平均）。
        - **角度:** 線與線、線與面、面與面之間的夾角。
        - **直徑/半徑:** 從擬合的圓柱或球體參數中獲得。
        - **輪廓度/平面度/圓度等 GD&T (Geometric Dimensioning and Tolerancing):** 根據工程圖紙定義的 GD&T 要求，評估實際零件幾何形狀與理論基準的偏差。

**具體舉例：檢測發動機葉盤上冷卻孔的直徑和位置**

1. **數據獲取:** 使用高精度結構光掃描儀掃描葉盤，獲得葉盤表面的高密度點雲。
2. **特徵提取:**
    - 針對每個冷卻孔區域的點雲子集。
    - 使用 RANSAC 演算法擬合圓柱體模型到孔洞內壁的點雲。
    - **設定範例:** RANSAC 距離閾值設為 0.02mm (根據預期精度)，最大迭代次數設為 1000 次，要求至少有 100 個內點才接受一個圓柱模型。可能需要預先設定預期的孔洞直徑範圍（例如 1.0mm ± 0.2mm）以提高擬合效率和魯棒性。
3. **幾何量測:**
    - 從最佳擬合的圓柱體模型參數中直接讀取孔洞的**直徑**。
    - 計算圓柱軸線與葉盤基準面（可能也是透過平面擬合得到）的**交點**，得到孔洞的**位置座標**。
    - 計算圓柱軸線與基準面的**夾角**，得到孔洞的**角度**。
4. **結果比對:** 將測量得到的直徑、位置、角度與 CAD 模型或工程圖紙上標註的公差範圍進行比較，判斷該孔洞是否合格。

---

### 2. CAD 配準 (CAD Registration) 於品質檢測的應用

CAD 配準是將實際掃描得到的零件 3D 數據（源數據 Source）與其理論設計的 CAD 模型（目標數據 Target）在空間中對齊的過程。找到一個最佳的剛性變換（包含旋轉和平移），使得掃描數據與 CAD 模型盡可能重合。

**目標：**

- 將掃描數據和 CAD 模型置於同一坐標系下。
- 實現掃描數據與設計模型的直接比較，以進行偏差分析。
- 驗證零件是否符合 GD&T 要求。

**常用技術與細節：**

- **a) 初始對齊 / 粗配準 (Initial Alignment / Coarse Registration):**
    
    - **目的:** 為後續的精確配準提供一個大致正確的初始位置姿態。如果初始偏差過大，精確配準演算法（如 ICP）可能會陷入局部最優或失敗。
    - **技術:**
        - **手動對齊 (Manual Alignment):** 由操作員在掃描數據和 CAD 模型上手動選取至少 3 對對應的特徵點，系統根據這些對應點計算初始變換矩陣。簡單直接，但依賴操作員經驗且效率不高。
        - **基於特徵的對齊 (Feature-Based Alignment):**
            - **細節:** 在掃描數據和 CAD 模型上自動檢測顯著的幾何特徵（如角點、邊緣、平面、孔洞中心等），並計算這些特徵的描述子（例如 FPFH - Fast Point Feature Histograms, SHOT - Signature of Histograms of OrienTations）。然後在特徵描述子空間中進行匹配，找到對應的特徵對。最後使用 RANSAC 等方法從匹配的特徵對中估算出穩健的初始變換矩陣。
            - **設定:** 特徵檢測器的參數（如角點檢測的顯著性閾值），特徵描述子的參數（如 FPFH 的鄰域半徑），特徵匹配的閾值（如描述子距離閾值），RANSAC 的參數（用於剔除錯誤匹配）。
        - **基於重心和主軸的對齊 (Centroid and Principal Axes Alignment):** 計算掃描數據和 CAD 模型的重心及主慣性軸，將兩者對齊。速度快，但僅適用於初始姿態偏差不大的情況，且對對稱性物件效果不佳。
- **b) 精確對齊 / 精配準 (Fine Alignment / Fine Registration):**
    
    - **目的:** 在粗配準的基礎上，進一步優化變換矩陣，使掃描數據和 CAD 模型達到最佳重合。
    - **技術:**
        - **迭代最近點演算法 (Iterative Closest Point - ICP):** 這是最常用、最經典的精配準演算法。
            - **核心步驟:**
                1. **尋找對應點 (Correspondence Finding):** 對於源數據（掃描點雲）中的每個點（或其子集），在目標數據（CAD 模型表面或其採樣點雲）上找到最近的點。常用 **k-d 樹** 等數據結構加速查找。
                2. **變換估計 (Transformation Estimation):** 根據找到的對應點對，計算能最小化它們之間距離（通常是平方距離和）的剛性變換（旋轉 R 和平移 t）。常用 **奇異值分解 (SVD)** 方法求解。
                3. **應用變換 (Apply Transformation):** 將計算得到的變換應用於源數據。
                4. **迭代與收斂判斷 (Iterate & Check Convergence):** 重複步驟 1-3，直到滿足收斂條件，例如：對應點的平均距離（或均方根誤差 RMSE）小於某個閾值、變換矩陣的變化量小於某個閾值、或者達到最大迭代次數。
            - **ICP 變種與改進:**
                - **Point-to-Plane ICP:** 最小化源點到目標點處法向量定義的切平面的距離。通常比 Point-to-Point ICP 收斂更快、精度更高，尤其適用於有平坦區域的物體。需要目標數據有可靠的法向量資訊（CAD 模型天然具備）。
                - **Generalized ICP (GICP):** 在誤差函數中同時考慮源點和目標點周圍的局部表面結構（協方差矩陣），對噪點和局部結構差異更具魯棒性。
                - **採樣策略 (Sampling Strategies):** 對於大型點雲，可以只使用部分點進行配準以提高效率，如隨機採樣、均勻採樣、基於法向量或曲率變化的特徵點採樣。
                - **異常值剔除 (Outlier Rejection):** 在尋找對應點或變換估計階段，剔除距離過遠或不一致的點對，以提高對噪點、遮擋或部分重疊的魯棒性。例如，可以設定一個最大對應距離閾值，或者在每次迭代中剔除一定比例（如 5-10%）誤差最大的點對。
            - **設定:** **最大迭代次數 (Max Iterations)** (e.g., 100)；**收斂閾值 (Convergence Threshold)** (e.g., RMSE < 0.001mm or transformation change < 1e-6)；**最大對應距離 (Max Correspondence Distance)** (e.g., 1mm, 根據粗配準精度設定)；**異常值剔除比例 (Outlier Rejection Ratio)** (e.g., 0.05)。

**具體舉例：驗證渦輪葉片曲面的輪廓度**

1. **數據獲取:** 使用高精度掃描儀獲取製造出的渦輪葉片點雲數據。
2. **獲取目標模型:** 載入該葉片的標準 CAD 模型（通常是 STEP 或 IGES 格式），並可能將其表面三角化或採樣成密集的點雲作為 ICP 的目標數據。
3. **粗配準:**
    - 可能利用葉片根部的平台、榫頭或特定邊緣等易於識別的宏觀特徵，進行基於特徵的自動粗配準。
    - **設定範例:** 使用 FPFH 特徵描述子，鄰域半徑設為點雲平均點距的 5 倍；使用 RANSAC 進行匹配，內點距離閾值設為 1mm。
4. **精配準:**
    - 在粗配準結果的基礎上，執行 Point-to-Plane ICP 演算法。
    - **設定範例:** 最大迭代次數 50 次；收斂閾值為 RMSE 變化小於 1e-5 mm；最大對應距離 0.5 mm；剔除 5% 的最遠對應點對。
5. **偏差分析 (Deviation Analysis):**
    - 配準完成後，掃描點雲與 CAD 模型已對齊。
    - 計算每個掃描點到其最近的 CAD 模型表面的**法向距離 (Normal Distance)**。這個距離即為該點的製造偏差。
    - 將這些偏差值以**色譜圖 (Color Map)** 的形式視覺化顯示在葉片模型上，紅色表示正偏差（材料多），藍色表示負偏差（材料少），綠色表示在公差帶內。
    - 根據工程圖紙上定義的葉片曲面**輪廓度公差**，判斷整個曲面或特定區域是否合格。超差區域會以特定顏色標示出來。

---

總之，在航空航太智慧製造與品質檢測中，電腦視覺中的幾何學提供了從掃描數據中精確提取和測量零件幾何資訊的工具，而 CAD 配準則是將實際零件與設計藍圖進行精確比對的橋樑。這兩者的結合，特別是利用像 RANSAC、ICP 及其變種等穩健的演算法，使得自動化、高精度的 3D 尺寸檢測和公差驗證成為可能，是確保航空零件品質與安全性的關鍵技術。