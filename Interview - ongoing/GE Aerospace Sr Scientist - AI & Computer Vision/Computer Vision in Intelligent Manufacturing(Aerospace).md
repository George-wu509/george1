
針對「智慧製造與品質檢測」應用中，我們來深入探討圖像分割、物件偵測、異常檢測以及表面檢測演算法這四個關鍵的電腦視覺技術方向，包含其在航空航太領域的具體應用、常用方法、技術細節、關鍵設定以及範例說明。(資訊截至 2025 年 3 月 30 日)

---

### 1. 圖像分割 (Image Segmentation)

- **核心概念與目標:** 圖像分割的目標是對影像中的**每個像素**進行分類，將其分配到預先定義的類別中（例如「背景」、「零件主體」、「裂紋」、「孔隙」等）。與僅提供邊界框的物件偵測相比，分割能提供更精確的空間定位和形狀資訊，對於需要精確測量缺陷尺寸、面積或理解複雜結構的場景至關重要。
    - **語義分割 (Semantic Segmentation):** 為圖像中的每個像素分配一個類別標籤（如圖中所有屬於「腐蝕」的像素都被標記為同一類）。它不區分同類別的不同實例。
    - **實例分割 (Instance Segmentation):** 不僅區分不同類別，還區分同一類別的不同個體（如圖中有三條獨立的裂紋，會分別標記為「裂紋1」、「裂紋2」、「裂紋3」的像素集合）。
- **常用技術與細節:**
    - **a) 傳統方法:**
        - **閾值法 (Thresholding):** 基於像素灰度值進行分割（如 Otsu's Method 自動尋找最佳閾值、自適應閾值）。**設定:** 全局閾值、自適應閾值鄰域大小和常數 C。常用作預處理步驟。
        - **區域生長 (Region Growing):** 從種子點開始，根據相似性準則（灰度、紋理）合併相鄰像素。**設定:** 種子點選擇、相似性判斷閾值。
        - **分水嶺演算法 (Watershed Algorithm):** 將圖像視為地形圖，根據梯度尋找集水盆。對分離接觸物體有效，但易產生過分割。**設定:** 標記物（Markers）的定義，避免過分割。
    - **b) 基於深度學習的方法 (目前主流):**
        - **全卷積網路 (Fully Convolutional Networks - FCN):** 奠基性工作，將分類網路的全連接層替換為卷積層，實現端到端的像素級預測。
        - **U-Net 及其變體 (UNet++, Attention U-Net):** 採用對稱的編碼器-解碼器架構，並加入「跳躍連接」(Skip Connections) 將編碼器的高解析度特徵傳遞給解碼器，有助於精確定位和細節恢復。非常適用於醫學影像和工業缺陷分割。**設定:** 網路深度（下採樣/上採樣次數）、初始卷積核數量、活化函數 (ReLU)、損失函數（常用 Dice Coefficient Loss 或 Focal Loss 處理類別不平衡問題，也可用 Cross-Entropy Loss）、優化器 (Adam)、學習率、大量的數據增強。
        - **DeepLab 系列 (v3, v3+):** 利用**空洞卷積 (Atrous/Dilated Convolution)** 在不增加計算量的情況下擴大感受野，並結合**空洞空間金字塔池化 (ASPP)** 捕捉多尺度上下文資訊。**設定:** 空洞卷積的膨脹率 (Dilation Rates)、輸出步幅 (Output Stride)。
        - **Mask R-CNN:** **實例分割**的代表性模型。它在 Faster R-CNN 物件偵測框架的基礎上，增加了一個並行的分支來為每個檢測到的物件預測一個二值掩碼 (Mask)。**設定:** 主幹網路 (Backbone, 如 ResNet-50/101)、區域提議網路 (RPN) 參數、RoIAlign 參數、掩碼頭部網路結構、各部分損失（分類、邊界框回歸、掩碼）的權重。
- **具體舉例：精確分割和量化複合材料層壓板中的孔隙缺陷**
    1. **目標:** 在複合材料零件的 X 光 CT 掃描切片影像中，準確地勾畫出內部孔隙（低密度區域）的輪廓，以便計算孔隙率、孔隙尺寸分佈等指標。
    2. **方法:** 使用 **U-Net** 或其變體進行語義分割。
    3. **數據:** 大量 CT 切片影像，其中孔隙區域已被專家手動標註出像素級掩碼。
    4. **訓練設定:** 訓練 U-Net 模型輸出每個像素屬於「孔隙」的機率。考慮到孔隙通常佔總體積比例很小，使用 Dice Loss 或加權的 Cross-Entropy Loss 來處理類別嚴重不平衡。採用 Adam 優化器，學習率 1e-4，並應用旋轉、縮放、加噪等數據增強。
    5. **預測與應用:** 將訓練好的模型應用於新的 CT 切片，得到孔隙機率圖。設定一個機率閾值（如 0.5）得到二值分割結果。對分割出的孔隙區域進行連通元件分析，計算每個孔隙的面積（或體積，如果是 3D U-Net）、等效直徑等幾何參數，最終匯總得到零件的孔隙率報告。

---

### 2. 物件偵測 (Object Detection)

- **核心概念與目標:** 物件偵測的目標是在圖像中定位出感興趣物體（或缺陷）的**位置**（通常用**邊界框 Bounding Box** 表示），並判斷其**類別**。相較於圖像分割，它不提供精確的輪廓，但對於只需要知道「什麼缺陷在哪裡」的場景，通常速度更快，計算資源需求也較低。
- **常用技術與細節:**
    - **a) 傳統方法:**
        - **滑動窗口 + 分類器:** 用不同大小和比例的窗口滑過圖像，對每個窗口內容用分類器（如 HOG+SVM）判斷是否包含目標。計算量大。
        - **基於模板匹配的方法:** 如前所述，對特定形狀的缺陷可能有效。
    - **b) 基於深度學習的方法 (目前主流):**
        - **兩階段檢測器 (Two-Stage Detectors):** 先生成候選區域 (Region Proposals)，再對這些區域進行分類和邊界框精修。精度通常較高。
            - **代表模型:** **Faster R-CNN** (引入了 RPN 網路生成候選區域), Cascade R-CNN。
            - **設定:** 主幹網路選擇 (ResNet, VGG)、RPN 錨框 (Anchor) 的尺寸和長寬比、非極大值抑制 (NMS) 閾值、RoI 池化/對齊方法。
        - **單階段檢測器 (One-Stage Detectors):** 直接在密集的採樣位置上預測類別和邊界框，速度更快。
            - **代表模型:** **YOLO (You Only Look Once)** 系列 (v3, v4, v5, v7, v8 等持續演進中), SSD (Single Shot MultiBox Detector), RetinaNet (引入 Focal Loss 解決類別不平衡), EfficientDet。
            - **設定:** 主幹網路、預測網格的大小 (YOLO)、錨框設計、損失函數（通常是分類損失、邊界框回歸損失、置信度/物件性損失的組合）、預測置信度閾值、NMS 閾值。
- **具體舉例：檢測渦輪葉片邊緣的微小缺口 (Nicks) 或凹痕 (Dents)**
    1. **目標:** 在渦輪葉片的光學檢測圖像（可能來自專用掃描設備）中，快速定位並標記出葉片前緣或後緣上的微小損傷。
    2. **方法:** 採用 **YOLOv8** 或 **EfficientDet** 等高效的單階段檢測器。
    3. **數據:** 大量葉片圖像，其中缺口和凹痕的位置已被標註為邊界框，並可能區分類別（如 "nick", "dent"）。需要包含不同光照、角度、葉片狀態（新舊、塗層差異）的圖像。
    4. **訓練設定:** 在大型通用數據集（如 COCO）上預訓練的模型基礎上進行微調。選擇適合小目標檢測的模型尺寸（如 YOLOv8-s 或 EfficientDet-D0/D1）。設定置信度閾值約 0.4-0.6，NMS 的 IoU 閾值約 0.4-0.5。應用針對性的數據增強（如隨機裁剪放大、亮度對比度變化）。
    5. **預測與應用:** 模型處理新的葉片圖像，輸出檢測到的每個缺陷的邊界框、類別和置信度分數。檢測結果可高亮顯示給檢驗員確認，或用於自動統計缺陷數量和位置。

---

### 3. 異常檢測 (Anomaly Detection) - 視覺應用

- **核心概念與目標:** 視覺異常檢測旨在識別圖像中與「正常」模式顯著不同的區域或物件，通常**不需要事先知道所有可能的缺陷類型**。這在以下情況特別有用：缺陷種類繁多、外觀多變；新類型缺陷可能出現；或者缺陷樣本非常稀少難以進行監督學習。其核心是學習「正常」的外觀模式，並檢測對該模式的偏離。
- **常用技術與細節:** (通常是無監督或半監督學習，主要使用正常樣本訓練)
    - **基於重構的方法 (Reconstruction-based):**
        - **模型:** **自動編碼器 (Autoencoder - AE)**, **變分自動編碼器 (VAE)**, **生成對抗網路 (GAN - 如 AnoGAN)**, **Transformer**。
        - **原理:** 模型學習如何完美地重構（壓縮再解壓）正常的輸入圖像。當輸入包含異常區域時，由於模型沒見過這種模式，重構效果會很差。通過比較原始圖像和重構圖像的差異（**重構誤差圖**），可以定位異常區域。
        - **設定:** 網路架構（常用 CNN 結構）、潛在空間維度、重構損失函數 (MSE, L1, SSIM)、異常分數的計算方式（如像素級誤差、區域誤差）及閾值。
    - **基於嵌入/度量學習的方法 (Embedding/Metric Learning-based):**
        - **模型:** **Deep SVDD**, **PatchCore**, SPADE。
        - **原理:** 使用預訓練的深度網路（如 ResNet, Wide-ResNet）提取圖像局部區域（**圖像塊 Patch**）的特徵向量（嵌入 Embedding）。模型學習「正常」樣本在特徵空間中的分佈（如 PatchCore 建立一個正常特徵的「記憶庫」）。測試時，如果一個圖像塊的特徵向量遠離已知的正常特徵分佈（如與記憶庫中最近鄰的距離過大），則判定為異常。
        - **設定:** 選擇預訓練的主幹網路、圖像塊大小、正常特徵庫的構建方式（如 Coreset Subsampling 選擇代表性樣本）、距離度量方式（歐氏距離、馬氏距離）、異常分數閾值。 **PatchCore 目前 (2025年) 在很多基準測試中表現領先。**
    - **基於密度估計的方法:**
        - **模型:** **歸一化流 (Normalizing Flows)**。
        - **原理:** 直接對正常圖像數據的概率密度進行建模。低概率密度的圖像或區域被視為異常。
- **具體舉例：檢測航空電子設備 PCB 板上的未知焊接缺陷或元件異常**
    1. **目標:** 自動檢測 PCB 板圖像上任何偏離標準外觀的異常，可能是各種未知或罕見的焊接缺陷（冷焊、橋接、錫珠）、元件貼裝錯誤、板面污染等。
    2. **方法:** 採用 **PatchCore** 算法。
    3. **數據:** 只需要大量已知合格的、無缺陷的 PCB 板圖像，在標準化光照條件下拍攝。
    4. **訓練 (構建正常特徵庫):** 使用在 ImageNet 上預訓練的 Wide-ResNet-50 提取 PCB 圖像中所有圖像塊的特徵。通過 Coreset subsampling 選擇一部分有代表性的正常特徵存儲起來。
    5. **檢測:** 對於一塊新的待檢 PCB 板圖像，同樣提取所有圖像塊的特徵。計算每個圖像塊特徵與其在正常特徵庫中最近鄰的距離（例如馬氏距離）。根據距離生成異常分數圖，分數高的區域即為潛在異常點，高亮顯示給操作員。
    6. **設定:** Wide-ResNet-50 作為主幹網路。圖像塊大小 32x32。Coreset subsampling 比例 1% 或 5%。異常分數閾值根據可接受的誤報率在驗證集上設定。

---

### 4. 表面檢測演算法 (Surface Inspection Algorithms)

- **核心概念與目標:** 這是一個更側重於分析物體**表面特性**（如紋理、光潔度、顏色、反射屬性）的技術集合，用於檢測那些主要表現為表面外觀變化的細微缺陷。它與前述技術有重疊，但更強調針對表面本身特性的分析方法。
- **常用技術與細節:**
    - **紋理分析 (Texture Analysis):**
        - **方法:**
            - **統計方法:** **灰度共生矩陣 (GLCM)** 計算像素對在不同方向和距離上的灰度關係，提取對比度、相關性、能量、同質性等特徵。**局部二值模式 (LBP)** 描述像素與其鄰域的相對灰度關係，對光照變化較不敏感。提取的紋理特徵可用於分類或異常檢測。
            - **頻譜方法:** **傅立葉變換 (Fourier Transform)** 分析圖像的頻率成分，週期性紋理會在頻譜上產生峰值。**小波變換 (Wavelet Transform)** 提供時頻局部化分析，能更好地捕捉紋理的局部變化和缺陷引入的異常頻率。
        - **設定:** GLCM 的距離和角度參數；LBP 的鄰域半徑和點數；小波基的選擇和分解層數。
    - **濾波技術 (Filtering Techniques):**
        - **方法:** 使用特定設計的濾波器來增強缺陷信號或抑制背景紋理。**Gabor 濾波器** 對特定頻率和方向敏感，可用於檢測劃痕等方向性缺陷。**形態學濾波**（如頂帽變換 Top-hat, 底帽變換 Bottom-hat）利用結構元素來提取圖像中相對於背景的亮或暗的細小結構。
        - **設定:** Gabor 濾波器的頻率、方向、帶寬；形態學濾波的結構元素形狀和大小。
    - **基於模型的方法:**
        - **光度立體 (Photometric Stereo):** 在固定相機、變換光源方向的條件下拍攝多張圖像，可以估計每個像素的表面法向量和反射率（反照率 Albedo）。表面法向量的異常可以揭示凹痕、凸起等三維形狀缺陷。需要精確控制的光源設置。
        - **條紋投影 / 偏折測量 (Deflectometry):** 向高反光（鏡面）表面投射已知圖案（如正弦條紋），觀察反射圖案的變形。變形直接反映了表面斜率的變化，對檢測鏡面上的凹坑、波紋非常敏感。需要專用硬體。
    - **深度學習應用:**
        - CNN 模型能夠在訓練過程中自動學習複雜的表面紋理特徵，無需手動設計。可用於監督式缺陷分類/分割，或無監督的異常檢測（如前述 Autoencoder 或 PatchCore 方法應用於紋理圖像）。
- **具體舉例：檢測飛機蒙皮鋁合金表面在陽極氧化處理後的細微燒蝕斑點**
    1. **目標:** 陽極氧化處理可以提高鋁合金的耐腐蝕性，但過程中可能產生細微的、顏色略有差異或紋理略粗糙的燒蝕斑點，影響外觀和潛在性能。需要自動檢測這些斑點。
    2. **方法:** 結合**小波變換和基於統計的異常檢測**。
    3. **實施:**
        - 在均勻光照下獲取陽極氧化後的鋁合金表面圖像。
        - 對圖像進行多尺度小波分解（如使用 Haar 或 Daubechies 小波）。
        - 計算每個尺度和方向的子帶圖像的局部能量（如小窗口內的方差或熵）。正常的、均勻的氧化層表面應該具有相對一致的能量分佈。
        - 燒蝕斑點可能會在特定的子帶（反映其尺度和紋理特性）引入異常的能量值。
        - 對從已知合格表面提取的正常能量特徵分佈進行建模（如計算均值和標準差，或使用高斯混合模型 GMM）。
        - 對於待測表面的圖像，計算其小波能量特徵。如果某個區域的特徵值偏離正常分佈超過一定閾值（如 3 sigma），則標記為異常（潛在燒蝕斑點）。
    4. **設定:** 小波基選擇、分解層數（如 3-5 層）、計算能量的窗口大小、異常判定的閾值。

---

### 總結

在航空航太智慧製造與品質檢測中，圖像分割、物件偵測、異常檢測和表面檢測演算法提供了強大的自動化視覺分析工具。它們常常**協同工作**在一個完整的檢測流程中：例如，先用**物件偵測**定位感興趣的零件區域，然後用**圖像分割**精確描繪零件輪廓或已知類型的缺陷，同時運行**異常檢測**來捕捉預料之外的外觀偏差，並可能輔以特定的**表面檢測演算法**來分析紋理或光潔度。深度學習方法，特別是 CNN 和 Transformer 架構，已成為實現這些任務的主流和最高效的技術，但其成功高度依賴於高質量的數據和針對具體應用的仔細模型設計與參數調優。