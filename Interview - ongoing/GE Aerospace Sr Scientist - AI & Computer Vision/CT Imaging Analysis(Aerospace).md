

|                                            |     |
| ------------------------------------------ | --- |
| [[### CT 成像分析在航太]]                         |     |
| [[###工業 CT Scan 3D reconstruction]]        |     |
| [[###比較3D reconstruction方法: FBP, FDK, IR]] |     |


### CT 成像分析在航太


針對「智慧製造與品質檢測」應用中，我們來深入探討「CT 成像分析 (CT Imaging Analysis)」這一關鍵部分，包含其在航太領域的重要性、常用技術、方法細節、關鍵設定以及具體範例。

### CT 成像分析在航太品質檢測的重要性

電腦斷層掃描（Computed Tomography, CT）是一種強大的非破壞檢測（Non-Destructive Testing, NDT）技術，它利用 X 光穿透物體，並從多個角度進行拍攝，再透過電腦演算法重建出物體內部結構的 3D 體積影像（由一系列 2D 灰階切片影像堆疊而成）。

在航空航太領域，許多關鍵零組件（如渦輪葉片、發動機匣、複合材料結構、增材製造零件等）具有複雜的內部結構（例如冷卻通道）或可能存在隱藏的內部缺陷（如孔隙、裂紋、夾雜物、脫層等）。這些內部特徵和缺陷直接影響零件的性能、壽命和飛行安全，且無法透過外部視覺檢查發現。CT 技術能夠在不損壞零件的情況下，提供其內部結構的詳細 3D 視圖，因此成為品質保證和失效分析不可或缺的工具。

然而，一個典型的工業 CT 掃描可能包含數百到數千張高解析度的切片影像，構成龐大的 3D 體積數據（常達 GB 甚至 TB 等級）。依賴人工逐片檢查這些數據不僅極度耗時、枯燥，而且容易因視覺疲勞和主觀判斷產生漏檢或誤判，尤其對於微小、低對比度的缺陷或複雜的幾何測量。因此，**利用 AI/機器學習/電腦視覺技術對 CT 體積影像進行自動化分析**，已成為提高檢測效率、精度和一致性的關鍵。

### CT 影像分析的主要任務與技術

CT 影像分析的主要任務包括內部缺陷檢測、內部尺寸量測、材料特性分析（如孔隙率評估）、裝配驗證以及與 CAD 模型的比對。以下詳細介紹常用技術，特別側重於缺陷檢測：

**1. 內部缺陷檢測 (Internal Defect Detection)**

- **目標:** 自動識別、定位並分類 CT 影像中的內部製造缺陷，例如：
    
    - **孔隙/氣孔 (Porosity/Voids):** 材料內部因鑄造、焊接或增材製造過程中產生的氣體空洞。
    - **夾雜物 (Inclusions):** 材料中存在的異質物（如熔渣、氧化物）。
    - **裂紋 (Cracks):** 材料內部的斷裂。
    - **未熔合/未焊透 (Lack of Fusion / Incomplete Penetration):** 在焊接或增材製造層間結合不良。
    - **脫層 (Delamination):** 複合材料層之間的分離。
- **常用技術與細節:**
    
    - **a) 傳統影像處理方法:**
        - **閾值分割 (Thresholding):** 根據灰階值差異來區分缺陷與背景材料（缺陷通常呈現較暗或較亮的灰階）。
            - **方法:** 全域閾值（如 Otsu's Method 自動尋找最佳閾值）、局部自適應閾值、手動設定閾值。
            - **設定:** 閾值的大小。
            - **優缺點:** 簡單快速，但對噪點、灰階不均勻（如射束硬化效應）、低對比度缺陷敏感。
        - **形態學操作 (Morphological Operations):** 在二值化影像（閾值分割後）上進行膨脹、腐蝕、開啟、閉合等操作，用以去除噪點、填補缺陷內部小洞、分離相連缺陷或連接斷裂部分。
            - **設定:** 結構元素的大小和形狀（如方形、圓形）。
        - **連通元件分析 (Connected Component Analysis / Blob Analysis):** 在二值化影像上，將相鄰的缺陷像素/體素（Voxel, Volume Pixel）組合成獨立的「斑點」(Blob)，並計算每個斑點的特徵（如體積、尺寸、形狀因子、平均灰階值）。
            - **設定:** 最小/最大斑點體積/尺寸閾值，用於過濾掉過小（可能是噪點）或過大（可能是正常結構）的區域。
    - **b) 基於機器學習的方法 (Supervised Learning):** 需要預先標註好的訓練數據（缺陷位置和/或類型）。
        - **基於特徵的機器學習:**
            - **流程:** 從感興趣區域 (ROI) 或體素鄰域提取人工設計的特徵（如灰階統計量、紋理特徵 - 灰度共生矩陣 GLCM、局部二值模式 LBP、形狀描述子等），然後使用傳統分類器（如支持向量機 SVM、隨機森林 Random Forest）進行分類。
            - **設定:** 特徵選擇、分類器超參數（如 SVM 的核函數、懲罰係數 C；隨機森林的樹數量、深度）。
            - **優缺點:** 對數據量需求相對較小，但依賴專家經驗設計有效特徵。
        - **基於深度學習的方法 (Deep Learning - CNNs):** 目前的主流和前沿方法，能自動從數據中學習有效的特徵表示。
            - **2D CNN:** 將 3D CT 體積視為一系列 2D 切片獨立處理或結合少量相鄰切片。
                - **方法:** 使用如 ResNet, VGG 等進行分類，或 U-Net 及其變體進行像素級分割。
                - **優缺點:** 模型相對簡單，訓練較快，但損失了 Z 軸（切片間）的空間關聯資訊。
            - **3D CNN:** 直接處理 3D 體積數據塊 (Patches) 或整個體積。
                - **方法:** **3D U-Net**, V-Net 等是常用於 3D 醫學影像和工業 CT 影像**分割**的架構，能輸出每個體素屬於缺陷的機率。也可用於 3D 數據塊的**分類**。
                - **優缺點:** 能充分利用 3D 空間上下文資訊，對具有複雜 3D 形狀的缺陷識別效果更好，但計算量大，需要更多數據和更強的計算資源。
            - **設定 (以 3D U-Net 分割為例):**
                - **網路架構:** 層數、每層的濾波器數量、卷積核大小。
                - **損失函數:** 常用 Dice Loss (處理類別不平衡較好)、Cross-Entropy Loss 或兩者結合。
                - **優化器:** Adam, SGD 等。
                - **學習率 (Learning Rate):** 控制模型更新步長。
                - **批次大小 (Batch Size):** 每次訓練迭代使用的樣本數。
                - **訓練週期 (Epochs):** 完整訓練數據集的訓練次數。
                - **數據增強 (Data Augmentation):** 對訓練數據進行隨機旋轉、縮放、翻轉、添加 CT 噪聲/偽影模擬等，以提高模型泛化能力。
                - **後處理:** 對模型輸出的機率圖進行閾值處理（如 > 0.5 判定為缺陷），應用形態學操作去除偽影，進行連通元件分析得到獨立缺陷。
    - **c) 異常檢測方法 (Unsupervised / Semi-supervised):** 當缺陷樣本稀少或形態多樣、難以標註時適用。主要學習「正常」數據的模式，將偏離模式的區域判定為異常（潛在缺陷）。
        - **方法:**
            - **自動編碼器 (Autoencoders - AE):** 特別是變分自動編碼器 (VAE) 或對抗性自動編碼器。模型學習壓縮和重建正常的 CT 數據塊，對於包含缺陷的區域，重建誤差會較大，可用於定位異常。
            - **生成對抗網路 (Generative Adversarial Networks - GANs):** 如 AnoGAN，學習生成逼真的正常 CT 影像，並尋找與輸入最匹配的生成影像，差異大的地方可能是異常。
            - **單類支持向量機 (One-Class SVM):** 在特徵空間中學習一個包圍正常樣本的邊界。
        - **設定:** 網路架構、潛在空間維度、重建損失權重、異常分數閾值。
- **具體舉例：檢測增材製造（3D 列印）的鎳基高溫合金渦輪葉片內部微小孔隙**
    
    1. **數據:** 獲取葉片的 3D CT 掃描體積數據。體素大小可能在 10-50 微米。
    2. **方法:** 採用 **3D U-Net** 進行語義分割。
    3. **標註:** 需要由 NDT 專家在部分 CT 數據上手動或半自動標註出孔隙區域作為訓練標籤 (Ground Truth)。
    4. **訓練:**
        - 將 CT 體積數據分割成重疊的 3D 數據塊（例如 96x96x96 體素）。
        - 使用標註數據訓練 3D U-Net 模型，區分孔隙體素和背景材料體素。
        - **設定範例:** 使用 Dice Loss + Focal Loss 作為損失函數，Adam 優化器，初始學習率 1e-4，Batch Size 設為 2 或 4 (受 GPU 記憶體限制)，訓練 100-200 epochs。進行包含隨機旋轉、加入高斯噪聲、模擬射束硬化偽影的數據增強。
    5. **推理與後處理:**
        - 將訓練好的模型應用於待檢測葉片的 CT 數據塊，得到每個體素是孔隙的機率圖。
        - 設定機率閾值（如 0.6）將機率圖二值化。
        - 應用 3D 形態學開操作 (Opening) 移除模型可能產生的小噪點偽影。
        - 進行 3D 連通元件分析，識別出每個獨立的孔隙，並計算其體積、等效球直徑、位置、與表面的距離等。
    6. **結果評估:** 根據預設的驗收標準（如：最大允許孔隙直徑、單位體積內孔隙總體積占比、關鍵區域不得有孔隙等）判斷葉片是否合格。將檢測到的孔隙資訊視覺化疊加在 3D 模型上，供工程師複核。

**2. 內部尺寸量測 (Internal Dimensional Metrology)**

- **目標:** 精確測量 CT 影像中無法從外部接觸的內部特徵尺寸，如複雜冷卻通道的壁厚、內部型腔的直徑、裝配間隙等。
- **技術:**
    - **邊緣/表面確定:** 需要非常精確地確定材料的邊界。這通常比缺陷檢測要求更高。可以基於灰階梯度、模型擬合（如擬合直線、圓、平面到邊界點）、或高精度的分割模型（如 U-Net）實現。
    - **幾何擬合:** 在確定的邊界點上擬合幾何基元（線、圓、平面、圓柱），從擬合參數中提取尺寸。
    - **CAD 模型對齊:** 將 CT 數據與 CAD 模型進行精確配準（使用 ICP 等演算法），然後在對齊後的模型上進行點到面或面到面的距離測量，得到與標稱尺寸的偏差。
- **設定考量:** CT 掃描的幾何精度校準、體素大小、表面確定演算法的閾值或參數、幾何擬合的穩健性。

**3. 材料特性分析 (Material Analysis)**

- **目標:** 評估材料的均勻性、分析孔隙率（更側重統計分佈而非單個缺陷定位）、檢測密度變化、分析複合材料中的纖維取向等。
- **技術:**
    - **孔隙率分析:** 基於缺陷檢測/分割的結果，進行統計分析，計算總孔隙體積占比、孔隙尺寸分佈直方圖、孔隙位置分佈等。
    - **密度分析:** 利用 CT 灰階值（需經過校準，轉換為 Hounsfield 單位或與已知密度標樣比對）分析材料密度的空間變化。
    - **紋理分析:** 計算 CT 影像的紋理特徵（如 GLCM, LBP），這些特徵有時能反映材料微觀結構的差異或均勻性。
    - **纖維分析 (複合材料):** 利用影像梯度、結構張量分析或專門訓練的 CNN 來估計複合材料中纖維束的方向和分佈。

**4. 裝配驗證 (Assembly Verification)**

- **目標:** 檢查多個零件組裝後，內部零件的位置、方向、間隙是否符合設計要求。
- **技術:**
    - 多物件分割：使用多類別分割模型（如多輸出 U-Net）同時分割出不同的內部零件。
    - 姿態估計與配準：對每個分割出的零件，估計其相對於裝配體坐標系或 CAD 模型的 6D 姿態（位置和方向），並與設計值比較。

### CT 數據分析的挑戰與考量

- **數據量巨大:** 需要高效的演算法和充足的計算資源（GPU）。
- **數據各向異性 (Anisotropy):** CT 掃描的切片厚度（Z 軸解析度）通常大於面內解析度（X, Y 軸），體素不是立方體，需要在演算法設計中考慮（如使用各向異性的卷積核）。
- **噪聲與偽影:** CT 影像固有噪聲（如泊松噪聲）和各種偽影（如射束硬化、金屬偽影、環狀偽影、散射線）會干擾分析，需要有效的預處理（濾波）或使用對噪聲/偽影穩健的演算法，或在訓練數據中加入偽影模擬。
- **標註成本高昂:** 監督式深度學習需要大量精確標註的數據，這對於 3D CT 內部缺陷而言，標註過程耗時費力且需要高度專業知識。這也促進了弱監督、半監督、無監督學習以及基於合成數據/模擬數據訓練的研究。
- **精度與校準:** 用於計量學時，CT 系統的幾何精度需要仔細校準和驗證。灰階值的準確性對於密度分析也很重要。

### 總結

利用 AI/機器學習對 CT 影像進行分析，為航空航太製造的品質檢測帶來了革命性的變化。它能夠自動、快速、客觀且精確地檢測隱藏的內部缺陷、測量複雜的內部尺寸、評估材料特性，極大地提升了檢測效率和可靠性，有助於確保航空產品的最高品質與飛行安全。隨著演算法的不斷進步和計算能力的提升，基於 AI 的 CT 分析技術將在未來航空航太領域的智慧製造和品質保證中扮演越來越重要的角色。


====================================================

### 工業 CT Scan 3D reconstruction


工業界（例如國防領域）如何從 X 射線影像建立電腦斷層掃描 (CT Scan) 影像，它與醫學 CT 的差別，以及 CT 掃描 3D 重建的演算法步驟。(資訊截至 2025 年 4 月 1 日)

### 一、 工業 CT Scan 如何從 X 光影像建立？

工業電腦斷層掃描 (Industrial Computed Tomography, ICT) 的基本原理與醫學 CT 相同：利用 X 射線穿透物體時不同材料和密度會產生不同程度的**衰減 (Attenuation)**（吸收和散射），從**多個不同角度**拍攝穿透物體後的 X 射線強度影像（即 2D 投影/Radiograph），然後通過數學演算法重建出物體內部結構的三維數位模型。

**典型工業 CT 系統的組成與流程：**

1. **X 射線源 (X-ray Source):** 產生 X 射線。根據待測物體的尺寸、密度和所需解析度，會使用不同類型的射源：
    - **微焦點/奈米焦點 X 射線管 (Microfocus/Nanofocus Tubes):** 焦點尺寸極小（微米甚至奈米級），能夠提供非常高的空間解析度，適用於檢測小型精密零件（如電子元件、複合材料微觀結構、小型鑄件）。功率相對較低。
    - **常規焦點/小焦點 X 射線管 (Minifocus Tubes):** 焦點較大，功率較高，掃描速度更快，適用於較大或密度較高的零件。
    - **線性加速器 (Linear Accelerators - Linacs):** 能夠產生能量非常高（MeV 等級）的 X 射線，用於穿透非常大或非常緻密的物體（如大型鑄件、發動機整機、火箭發動機、混凝土結構等）。
2. **偵測器 (Detector):** 接收穿過物體後的 X 射線，並將其強度轉換為數位訊號。現代工業 CT 最常用的是：
    - **平板偵測器 (Flat Panel Detectors - FPDs):** 大面積的數位偵測器，通常由閃爍體層（將 X 射線轉為可見光）和光電二極體陣列（將光轉為電荷）組成。能夠一次性捕捉整個二維投影影像。解析度由像素大小決定。
    - **線陣偵測器 (Line Detectors):** 由一排或多排偵測單元組成，需要配合物體平移或扇形射束掃描，速度較慢，但在某些高動態範圍應用中仍有使用。
3. **樣品操縱系統 (Manipulation System):** 精確地控制待測物體相對於射源和偵測器的位置和姿態。最核心的是一個高精度的**旋轉工作台 (Turntable)**，通常還配有垂直和水平方向的**平移台 (Linear Stages)**，用於調整掃描位置或進行螺旋掃描等。系統的穩定性和定位精度對重建品質至關重要。
4. **數據採集與控制系統:** 控制 X 射線源的開關與參數、偵測器的曝光與讀取、以及樣品操縱系統的運動，同步採集各個角度的投影數據。
5. **影像重建計算機與軟體:** 配備高性能計算硬體（常使用 GPU 加速）和專門的重建軟體，執行後續的 3D 重建演算法。

**數據採集過程 (以最常見的圓錐射束 Cone-Beam CT 為例):**

1. **樣品放置:** 將待檢測的工業零件（如葉片、焊縫、電池、3D 列印件）固定在旋轉工作台上。
2. **掃描設置:** 設定 X 射線源的電壓、電流（決定能量和強度）、偵測器的曝光時間、旋轉角度步長等參數。
3. **投影採集:** 啟動掃描。工作台以設定的角度步長（例如 0.25° 或 0.5°）逐步旋轉，通常需要旋轉 360° 或至少 180°+錐角。在**每一個角度位置**，X 射線源發射 X 光穿透樣品，平板偵測器捕捉一張 **2D 投影影像**。這張影像記錄了從射源焦點到偵測器每個像素連線路徑上的 X 射線總衰減量。
4. **重複採集:** 重複步驟 3，直到完成所有預定角度的拍攝，獲得**數百至數千張**不同角度的 2D 投影影像。
5. **校準數據採集:** 通常在掃描前後還需要採集**暗場 (Dark Field)**（關閉 X 光源時偵測器的讀數，用於扣除背景噪聲）和**平場 (Flat Field / Gain)**（不放樣品時偵測器的讀數，用於校正像素響應不均勻和射線源強度變化）圖像，用於後續的數據預處理。

這一系列從不同角度獲取的 2D 投影影像，就是進行 3D 重建的原始輸入數據。

### 二、 工業 CT 與醫學 CT 的主要差別

雖然基本原理相同，但由於應用對象和目標的不同，工業 CT 和醫學 CT 在許多方面存在顯著差異：

|特性|工業 CT (Industrial CT)|醫學 CT (Medical CT)|
|---|---|---|
|**應用目的**|無損檢測(NDT)、質量控制、尺寸測量(Metrology)、逆向工程、材料分析、失效分析、裝配檢查|疾病診斷、損傷評估、手術規劃、治療監控 (主要用於人體或動物)|
|**掃描對象**|各種工程材料（金屬、陶瓷、複合材料、塑料、電子元件等），尺寸、密度、幾何形狀範圍廣泛|生物組織（軟組織、骨骼），密度差異相對較小，形狀相對固定（人體解剖結構）|
|**X 射線能量**|範圍極廣 (幾十 keV 到幾十 MeV)，依對象選擇。微/奈米焦點用於高解析度，線性加速器用於高穿透力。|相對較低 (通常幾十到 140 keV)，優化軟組織對比度，使用旋轉陽極 X 光管。|
|**空間解析度**|要求通常**更高**，可達微米甚至亞微米級別，以檢測微小缺陷或測量精密尺寸。|通常在毫米或亞毫米級別即可滿足診斷需求。|
|**掃描時間**|可以**較長**（數分鐘到數小時），以獲取更高信噪比和解析度的數據。物體通常靜止不動。|要求**快速**（幾秒到數十秒），以減少病人運動偽影和輻射劑量。|
|**輻射劑量**|對被測**物體**本身通常無劑量限制（但需確保操作人員安全），可以使用較高劑量獲取更好圖像。|**嚴格控制**並盡可能降低 (ALARA 原則)，以保護病人健康。|
|**掃描幾何**|常用**圓錐射束 (Cone-Beam)** + 平板偵測器 + 物體旋轉。幾何配置靈活，可適應多樣化物體。可能有特殊掃描方式（如螺旋、有限角度、離焦、 laminography）。|常用**扇形射束 (Fan-Beam)** + 弧形或線陣偵測器 + 射源和偵測器圍繞病人高速旋轉（機架 Gantry），常配合**螺旋掃描**。|
|**尺寸測量精度**|**重要目標之一 (Metrological CT)**，需要精密的幾何校準、偽影校正和專用測量軟體。|通常不是主要目標，診斷性讀片更關注形態和病理變化。|
|**軟體與分析**|著重於缺陷自動識別與量化、尺寸測量、與 CAD 模型比對、材料密度/孔隙率分析、纖維方向分析等。|著重於解剖結構顯示、病灶檢測、三維可視化（如 MPR, MIP, VR）、影像存檔與傳輸系統 (PACS)。|

匯出到試算表

### 三、 CT Scan 3D 重建的演算法步驟

從採集到的一系列 2D 投影數據重建出 3D 體積數據，最常用的是**濾波反投影法 (Filtered Back-Projection, FBP)** 及其針對圓錐射束的變種 **FDK 演算法 (Feldkamp-Davis-Kress)**。迭代重建法也是一種重要的替代方案。

**基於 FDK 的濾波反投影重建步驟 (概念性說明):**

1. **數據預處理 (Preprocessing / Correction):**
    
    - **原始數據校正:** 從原始投影數據中減去**暗場**圖像，然後除以**平場**圖像（減去暗場後）進行歸一化，校正偵測器像素響應不一致。同時處理壞點。
    - **對數變換:** 將歸一化後的透射強度比 `I/I0` 轉換為線積分衰減值 `p = -ln(I/I0)`。這是因為 X 射線衰減遵循比爾-朗伯定律 (Beer-Lambert Law)，取對數後，沿射線路徑的總衰減變成了各點線性衰減係數的線積分，便於後續線性重建。
    - **(可選但常用) 偽影校正:** 進行**射束硬化 (Beam Hardening)** 校正（X 射線穿過物體時平均能量變高導致的衰減非線性）、**散射線 (Scatter)** 校正等，以提高重建精度和圖像品質。
2. **投影數據濾波 (Filtering):**
    
    - 對**每一張**經過預處理和對數變換後的 2D 投影數據 `p(θ, u, v)` （`θ` 為旋轉角度，`(u, v)` 為偵測器像素坐標）進行濾波操作。
    - **核心操作:** 通常是對投影圖像的**每一行** (固定 `v` 和 `θ`) 作為一個 1D 信號，與一個**高通濾波核 (High-pass Filter Kernel)** 進行卷積運算。常用的濾波核有 Ram-Lak (斜坡濾波器)、Shepp-Logan、Cosine 等。
    - **濾波目的:** 簡單的直接反投影會導致圖像模糊（產生 1/r 型模糊）。濾波操作本質上是進行類似微分的運算，目的是在反投影前對數據進行「預補償」，抵消反投影過程引入的模糊，從而得到清晰的重建圖像。不同的濾波核在抑制噪聲和保持邊緣銳利度之間有不同的權衡。
    - **FDK 的特殊性:** 對於圓錐射束，FDK 算法在濾波和反投影步驟中會引入與射線角度和位置相關的**權重因子**，以近似地處理錐角帶來的幾何效應。
3. **反投影 (Back-Projection):**
    
    - **創建重建體積:** 在計算機內存中創建一個三維網格（體素 Voxel 陣列），代表要重建的物體空間。初始值通常設為 0。
    - **逐個體素計算:** 對於三維網格中的**每一個體素** `(x, y, z)`：
        - **計算投影位置:** 對於**每一個**採集的投影角度 `θ`，計算出體素 `(x, y, z)` 在該角度下會投影到偵測器上的哪個像素位置 `(u, v)`。這需要知道該角度下 X 射線源和偵測器的精確幾何位置。
        - **讀取濾波後的值:** 從該角度對應的、**已經濾波過的** 2D 投影圖像中，讀取（通常需要插值，如雙線性插值）計算出的像素位置 `(u, v)` 處的值。
        - **累加貢獻:** 將讀取到的濾波後投影值**累加**到體素 `(x, y, z)` 的當前值上。FDK 算法在此步也會乘以一個與幾何位置相關的權重因子。
    - **重複:** 對所有體素、所有投影角度重複上述過程。
    - **直觀理解:** 這個過程就像將每一張濾波後的投影圖像，沿着 X 射線穿過的路徑，「塗抹」回三維空間中。由於數據經過了濾波預補償，來自不同角度的「塗抹」疊加後，真實的內部結構會被增強，而模糊和偽影則會相互抵消。
4. **後處理 (Post-processing):**
    
    - **定標:** 將重建出的線性衰減係數值轉換為更有意義的單位，如 Hounsfield Unit (HU，醫學常用) 或相對於已知材料（如水、鋁）的密度值。
    - **圖像處理:** 可能應用三維濾波器（如中值濾波、各向異性擴散）來降噪，或進行邊緣增強等。
    - **輸出與可視化:** 將重建的 3D 體積數據保存為標準格式（如 DICOM 序列、TIFF 棧、或其他體數據格式），並使用專業軟體進行 2D 切片瀏覽或 3D 體渲染 (Volume Rendering) 可視化。

**迭代重建法 (Iterative Reconstruction) 作為替代：**

- **概念:** 與 FBP/FDK 不同，迭代法從一個初始的 3D 體積猜測開始，反覆執行以下步驟：(1) **正向投影:** 根據當前體積猜測，模擬 X 射線穿過過程，生成模擬投影。(2) **比較與計算誤差:** 將模擬投影與實際採集的投影進行比較，計算差異。(3) **體積更新:** 根據誤差，使用某種優化演算法（如 ART, SART, OSEM, MLEM）更新 3D 體積猜測，使得模擬投影更接近實際投影。(4) **重複**直到收斂或達到最大迭代次數。
- **優缺點:** 計算量遠大於 FBP/FDK，耗時長。但能更好地處理數據不完整（如投影角度有限）、噪聲高、或需要精確建模複雜物理效應（如散射、多能量譜）的情況。在醫學 CT 中用於低劑量掃描，在工業 CT 中用於特殊應用。

總之，工業 CT 通過精密的硬體採集多角度 X 光投影，再利用如 FDK 等重建演算法，將這些二維信息轉換為能夠揭示物體內部結構、缺陷和尺寸的三維數字體積模型，為國防、航空航太、汽車、電子等領域的質量保證和研發提供了強有力的無損檢測手段。




============================================

### 比較3D reconstruction方法: FBP, FDK, IR

詳細比較 CT 掃描重建中三種主要的演算法：**濾波反投影法 (Filtered Back-Projection, FBP)**、其針對圓錐射束的擴展 **FDK 演算法 (Feldkamp-Davis-Kress)**，以及**迭代重建法 (Iterative Reconstruction, IR)**。

**背景:** CT 重建的目標是利用從不同角度獲取的 X 光投影數據，來計算出物體內部線性衰減係數（與密度相關）的三維分佈圖。選擇哪種重建演算法會直接影響到最終圖像的品質（如解析度、噪聲、偽影）以及重建所需的時間。

**比較表:**

|特性 / 比較項目|FBP (濾波反投影法)|FDK (Feldkamp-Davis-Kress)|Iterative Reconstruction (迭代重建法)|
|:--|:--|:--|:--|
|**演算法類型**|**解析法 (Analytical)** <br>基於 Radon 逆變換的直接數學反演公式。|**解析法 (Analytical)** <br>是 FBP 針對圓錐射束幾何的近似擴展。|**迭代法 / 數值優化法 (Iterative / Numerical Optimization)** <br>通過反覆優化來逼近真實解。|
|**適用掃描幾何**|主要用於 **2D 平行射束 (Parallel-beam)** 和 **2D 扇形射束 (Fan-beam)**。理論上也可擴展到 3D 平行射束。|主要用於 **3D 圓錐射束 (Cone-beam)** 且採用**圓形掃描軌跡**的情況。|**通用性強**，可適用於幾乎所有掃描幾何（平行、扇形、圓錐、螺旋、任意軌跡），對非標準軌跡或數據採集方式更靈活。|
|**核心原理/方法**|1. 投影數據預處理（對數轉換、校正）。<br> 2. 在傅立葉域或空間域對投影數據應用一個**斜坡濾波器 (Ram-Lak)** 或其變種進行**濾波**，以消除反投影引入的模糊。<br> 3. 將濾波後的投影數據沿原始射線路徑**反投影 (Back-Project)** 回圖像空間並累加。|1. 類似 FBP 的預處理。<br> 2. 對投影數據進行**加權**和**濾波**（濾波核類似 FBP）。<br> 3. 將加權濾波後的數據進行**加權反投影**。引入的權重因子是為了近似地補償圓錐射束帶來的幾何發散效應。|1. 設定一個初始的 3D 體積圖像猜測（如均勻值）。<br> 2. **正向投影：** 根據當前體積圖像，模擬 X 光穿過過程，計算出模擬的投影數據。<br> 3. **比較與誤差計算：** 將模擬投影與實際測量的投影數據進行比較，計算差異/誤差。<br> 4. **體積更新：** 根據誤差和採用的特定迭代算法（如 ART, SART, OSEM, MLEM）修正 3D 體積圖像。<br> 5. **重複**步驟 2-4，直到圖像質量收斂或達到預設迭代次數。|
|**計算成本/速度**|**非常快**。主要計算量在於濾波（可用 FFT 加速）和反投影。是三者中最快的。|**快**。計算量比 FBP 略大（因為有權重計算），但仍屬於快速的解析法。|**非常慢**。計算成本遠高於 FBP/FDK，因為需要進行多次迭代，且每次迭代都包含計算量大的正向投影和反投影（或類似）操作。需要強大的計算資源（尤其是 GPU）。|
|**影像品質 (噪聲)**|對測量噪聲比較敏感。濾波過程中的高通特性會**放大高頻噪聲**。|類似 FBP，對噪聲也較敏感。權重因子可能輕微影響噪聲模式。|**噪聲抑制能力較強**。可以更容易地在迭代過程中納入噪聲的統計模型（如泊松噪聲）或加入正則化項 (Regularization) 來平滑噪聲，尤其在低劑量（高噪聲）情況下優勢明顯。|
|**影像品質 (偽影)**|對投影數據不完整（如角度採樣不足、物體超出視野）很敏感，容易產生**條紋偽影 (Streak artifacts)**。對於其適用的幾何（平行/扇形），理論上無圓錐束偽影。|作為**近似算法**，當 X 射線的**錐角較大**時，會引入**圓錐束偽影 (Cone-beam artifacts)**，特別是在離中心平面較遠的區域會出現模糊和變形。對數據不完整同樣敏感。|**能更好地處理數據不完備**的情況（如稀疏角度採樣、有限角度掃描、金屬偽影），重建出的圖像偽影通常較少。但迭代算法本身也可能引入新的偽影（如過度平滑、塊狀紋理），且收斂不足也會導致問題。|
|**數據要求**|需要**密集且完整**角度的投影數據（滿足 Radon 變換的採樣要求）才能獲得高質量重建。|同 FBP，理論上也需要密集且完整的角度採樣。|**對數據量的要求相對較低**。即使在投影數據不足（角度稀疏、缺失）的情況下，也能重建出質量優於 FBP/FDK 的圖像，因為可以利用先驗信息或正則化。|
|**建模能力**|難以直接將複雜的物理效應（如散射、射束硬化、多能量譜）或先驗知識（如圖像的平滑性）納入重建模型中。|同 FBP。|**靈活性高**。可以在迭代模型中方便地加入對複雜物理效應的校正模型、精確的系統幾何模型、噪聲統計模型，以及各種圖像先驗信息（如總變分 Total Variation - TV 正則化，要求圖像分片平滑）。|
|**數學精確性**|對於平行射束和扇形射束幾何，在理想（無噪聲、連續無限採樣）條件下，是 Radon 逆變換的**精確**數學解。|**近似解**。只有在錐角趨近於零時才等同於扇形射束 FBP。對於有限錐角，不是數學上的精確反演。|**非解析解**。是尋找一個在某種意義下（由目標函數和正則化項定義）與測量數據最一致的圖像解。解的最優性和準確性依賴於模型設定和收斂情況。|
|**典型應用場景**|早期 CT 系統；部分對速度要求極高且幾何簡單的 2D 工業應用；演算法教學和理論分析。|**目前絕大多數採用圓形軌跡的工業 CT 和牙科 CBCT (Cone-Beam CT) 系統的標準/主流重建算法**，因其速度快且在中小錐角下效果可接受。|**醫學 CT**（特別是需要降低輻射劑量的掃描、心臟 CT、能譜 CT）；需要高精度定量分析或處理嚴重偽影/數據缺失的**高階工業 NDT 應用**；**科研領域**（開發新掃描模式或重建理論）。|

匯出到試算表

**總結與權衡:**

- **FBP/FDK:**
    - **優點:** 速度極快，實現相對簡單，理論成熟。
    - **缺點:** FDK 是近似解，存在錐角偽影；兩者對噪聲敏感，對數據完整性要求高，難以融合複雜模型。
- **迭代重建法 (IR):**
    - **優點:** 圖像質量潛力高（尤其在低劑量/數據不完備時），噪聲抑制好，偽影少，建模靈活（可加入物理模型和先驗）。
    - **缺點:** 計算成本極高，速度慢，算法實現和參數調整更複雜，可能引入迭代相關的偽影。

**選擇哪種方法取決於具體的應用需求：**

- 如果**速度**是首要考慮，且掃描對象不大、錐角不極端、數據質量較好，**FDK** 是工業 CT 中非常實用且廣泛的選擇。
- 如果對**圖像質量**（特別是噪聲和偽影抑制）有極高要求，或者**數據採集受限**（如稀疏角度、有限角度），或者需要進行**精確定量分析**並考慮複雜物理效應，那麼犧牲時間成本選擇**迭代重建法**可能是更優的方案。
- 原始的 **FBP** 主要用於 2D 或特殊平行束系統。

隨著計算能力的增強（尤其是 GPU 的發展），迭代重建法的應用越來越廣泛，但 FDK 因其速度優勢，在許多標準工業 CT 應用中仍然佔據主導地位。混合方法或深度學習輔助的重建方法也是當前研究的熱點。



這個問題涉及到 CT 重建演算法 Filtered Back Projection (FBP) 的核心原理。簡單來說，FBP 中使用的濾波器（Filter）必須是**高通濾波器 (High-pass filter)**，主要是為了**抵銷「反投影 (Back Projection)」本身造成的圖像模糊**。

以下是詳細說明步驟：

1. **CT 掃描與投影數據:** CT 掃描儀圍繞物體旋轉，從多個角度發射 X 光並測量穿透物體後的強度。這些測量值經過對數轉換等處理後，得到物體在該角度下的**投影數據 (Projection Data)**，也稱為**正弦圖 (Sinogram)**。每一條投影線代表了 X 光路徑上物體衰減係數的線積分。
    
2. **簡單反投影 (Simple Back Projection):** 如果我們直接將每個角度的投影數據「塗抹」回圖像空間（沿著原始 X 光的路徑反向投影回去），會得到一個圖像。但是，這個圖像會非常**模糊**。
    
3. **反投影造成的模糊 (1/r Blurring):** 為什麼會模糊？想像一下原始物體中有一個非常小的點。在簡單反投影過程中，這個點會在重建圖像中形成一個星狀或放射狀的模糊圖案。從數學上看，這個點擴散函數 (Point Spread Function, PSF) 近似於 `1/r` 的形式（其中 r 是到該點的距離）。將物體內所有點的 `1/r` 模糊疊加起來，就造成了整張圖像的模糊。這種模糊在頻率域中表現為**低頻成分被過度放大，而高頻成分被壓抑** (傅立葉轉換後的幅度近似與 `1/|f|` 成正比，其中 `f` 是空間頻率)。
    
4. **濾波的目的：抵銷模糊:** 為了得到清晰的圖像，我們需要在反投影之前對投影數據進行處理，以**補償**或**抵銷**掉反投影將會引入的這種 `1/r` 模糊效應。我們需要一個濾波器，它的作用正好與 `1/|f|` 的模糊效應相反。
    
5. **斜坡濾波器 (Ramp Filter):** 根據傅立葉中心切片定理 (Fourier Slice Theorem) 和 Radon 轉換的反轉換公式，理論上「完美」的濾波器是**斜坡濾波器 (Ramp Filter)**。這個濾波器在頻率域的響應（幅度）正好是 `|f|`。
    
    - **為什麼是 `|f|`？** 因為 `|f| * (1/|f|) = 1`。也就是說，用 `|f|` 濾波器去乘以因反投影而產生的 `1/|f|` 效應，正好可以將頻譜校正回來，恢復原始物體的頻率分佈。
6. **`|f|` 的高通特性:** 斜坡濾波器 `|f|` 的特性是：
    
    - 對於頻率 `f=0`（直流成分），濾波器值為 0，完全抑制。
    - 對於頻率 `|f|>0`，濾波器的值隨著頻率的增加而線性增加。
    - 這意味著它**增強高頻信號**（對應圖像的邊緣、細節）並**抑制低頻信號**（對應圖像的平滑區域、背景）。這正是**高通濾波器**的典型特徵。
7. **為什麼不是其他濾波器？**
    
    - **低通濾波器 (Low-pass filter):** 會進一步壓抑高頻、增強低頻，使得反投影後的圖像更加模糊，完全違背了重建的目的。
    - **帶通濾波器 (Band-pass filter):** 只保留特定頻段，會丟失重要的低頻（整體輪廓）和高頻（細節）信息。
    - **帶阻濾波器 (Band-stop filter):** 只去除特定頻段，無法校正 `1/r` 造成的整體頻譜失真。
8. **實際應用中的修正:** 理想的斜坡濾波器 `|f|` 會無限放大高頻噪聲。在實際應用中，由於投影數據含有噪聲（特別是高頻噪聲），直接使用純粹的 Ramp Filter 會導致重建圖像的噪聲被嚴重放大。因此，實際的 FBP 算法會使用一個**加窗的斜坡濾波器 (Windowed Ramp Filter)**，例如 Shepp-Logan 濾波器、Hamming 窗濾波器等。這些濾波器在低頻和中頻部分仍然保持 `|f|` 的斜坡特性（高通特性），但在高頻部分會平滑地滾降 (roll-off)，以抑制噪聲的過度放大。儘管加了窗，其核心的**高通濾波特性**依然是必需的，用以克服反投影的模糊。
    

**總結:**

CT scan 的 FBP 算法使用高通特性的濾波器（主要是加窗的斜坡濾波器），根本原因是為了**補償（或反轉）簡單反投影操作本身引入的 `1/r` 型模糊效應**。這種模糊效應在頻域表現為低頻過強、高頻不足，而高通濾波器（特別是 `|f|` 型的斜坡濾波器）正好可以校正這種頻譜失真，恢復圖像的清晰度和細節。


Reference:
https://www.youtube.com/watch?v=H_dReVZ6zlM