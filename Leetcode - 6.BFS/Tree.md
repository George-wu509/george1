Lintcode 1413
ç»™å‡ºä¸¤ä¸ªlist xï¼Œyï¼Œä»£è¡¨x[i]ä¸y[i]ä¹‹é—´æœ‰ä¸€æ¡è¾¹ï¼Œæ•´ä¸ªè¾¹é›†æ„æˆä¸€æ£µæ ‘ï¼Œ`1`ä¸ºæ ¹ï¼Œç°åœ¨æœ‰ä¸ªlist a,bï¼Œè¡¨ç¤ºè¯¢é—®èŠ‚ç‚¹a[i]ä¸b[i]æ˜¯ä»€ä¹ˆå…³ç³»ï¼Œå¦‚æœa[i]ä¸b[i]æ˜¯å…„å¼Ÿï¼Œå³æœ‰åŒä¸€ä¸ªçˆ¶èŠ‚ç‚¹ï¼Œè¾“å‡º`1`ï¼Œå¦‚æœa[i]ä¸b[i]æ˜¯çˆ¶å­å…³ç³»ï¼Œè¾“å‡º`2`ï¼Œå¦åˆ™è¾“å‡º`0`ã€‚


**æ ·ä¾‹ 1:**
```python
"""
è¾“å…¥ï¼› x = [1,1], y = [2,3], a =[1,2], b = [2,3]
è¾“å‡ºï¼š[2,1]
è§£é‡Šï¼š1ä¸2æ˜¯çˆ¶å­å…³ç³»ï¼Œ2ä¸3æ˜¯å…„å¼Ÿå…³ç³»ï¼Œå®ƒä»¬çš„å…±åŒçˆ¶èŠ‚ç‚¹ä¸º1ã€‚
```
è§£é‡‹:
2 - 1 - 3    

**æ ·ä¾‹ 2ï¼š**
```python
"""
è¾“å…¥ï¼šx = [1,1,2], y =[2,3,4], a = [1,2,1], b = [2,3,4]
è¾“å‡ºï¼š[2,1,0]ã€‚
è§£é‡Šï¼š1ä¸2æ˜¯çˆ¶å­å…³ç³»ï¼Œ2ä¸3æ˜¯å…„å¼Ÿå…³ç³»ï¼Œå®ƒä»¬çš„å…±åŒçˆ¶èŠ‚ç‚¹ä¸º1ï¼Œ1ä¸4ä¸æ˜¯å…„å¼Ÿå…³ç³»ä¹Ÿä¸æ˜¯çˆ¶å­å…³ç³»ã€‚
```
è§£é‡‹:
4 - 2 - 1 - 3    
graph = {1:{2,3}, 2:{1,4}, 3:{1}, 4:{2}}
parent = {1: None, 2: 1, 3:1, 4:2}

```python
class Solution:
    """
    @param x: The x
    @param y: The y
    @param a: The a
    @param b: The b
    @return: The Answer
    """
    def tree(self, x, y, a, b):
        graph = self.build_graph(x, y)
        parent = self.build_tree(graph)
        
        results = []
        for u, v in zip(a, b):
            if parent[u] == parent[v]:
                results.append(1)
            elif parent[u] == v or parent[v] == u:
                results.append(2)
            else:
                results.append(0)
        return results
    
    def build_graph(self, x, y):
        graph = {}
        for u, v in zip(x, y):
            if u not in graph:
                graph[u] = set()
            if v not in graph:
                graph[v] = set()
            graph[u].add(v)
            graph[v].add(u)
        return graph
        
    def build_tree(self, graph):
        from collections import deque
        visited = set([1])
        queue = deque([1])
        parent = {1: None}
        while queue:
            node = queue.popleft()
            for neighbor in graph[node]:
                if neighbor in visited:
                    continue
                visited.add(neighbor)
                queue.append(neighbor)
                parent[neighbor] = node
        return parent
```
pass


# **LintCode 1413: O(1) Tree è§£æ³•åˆ†æ**

## **è§£é¡Œç›®æ¨™**

çµ¦å®šä¸€æ£µ **ç„¡å‘æ¨¹**ï¼Œå…¶é‚Šç”±å…©å€‹é™£åˆ— `x` å’Œ `y` è¡¨ç¤ºï¼Œåˆ†åˆ¥å­˜å„²æ¨¹ä¸­çš„é‚Š `(x[i], y[i])`ï¼Œæˆ‘å€‘éœ€è¦å›ç­” **å¤šçµ„æŸ¥è©¢ `(a[i], b[i])`**ï¼Œåˆ¤æ–·å…©å€‹ç¯€é» `a[i]` å’Œ `b[i]` ä¹‹é–“çš„é—œä¿‚ï¼š

1. è‹¥ `a[i]` å’Œ `b[i]` å±¬æ–¼**åŒä¸€å€‹å­æ¨¹**ï¼Œå‰‡å›å‚³ `1`ã€‚
2. è‹¥ `a[i]` æˆ– `b[i]` **æ˜¯å°æ–¹çš„ç›´æ¥çˆ¶ç¯€é»**ï¼Œå‰‡å›å‚³ `2`ã€‚
3. å¦å‰‡å›å‚³ `0`ï¼ˆå…©è€…ä¸åœ¨åŒä¸€å€‹å­æ¨¹ï¼‰ã€‚

---

## **è§£æ³•æ ¸å¿ƒ**

é€™æ˜¯ä¸€å€‹ **æ¨¹çš„åœ–è«–å•é¡Œ**ï¼Œæˆ‘å€‘å¯ä»¥æ‹†è§£æˆå…©å€‹ä¸»è¦æ­¥é©Ÿï¼š

1. **æ§‹å»ºæ¨¹ (Graph Construction)**ï¼š
    - é€é `x[i]` å’Œ `y[i]` å»ºç«‹é„°æ¥è¡¨ `graph` ä¾†è¡¨ç¤ºæ¨¹ã€‚
2. **æ¨™è¨˜çˆ¶ç¯€é» (Tree Construction & Parent Mapping)**ï¼š
    - ä½¿ç”¨ **BFS éæ­·æ¨¹**ï¼Œç¢ºå®šæ¯å€‹ç¯€é»çš„**çˆ¶ç¯€é»**ï¼Œå»ºç«‹ `parent` æ˜ å°„è¡¨ã€‚
3. **è™•ç†æŸ¥è©¢**ï¼š
    - æ ¹æ“š `parent` æ˜ å°„è¡¨ï¼Œåˆ¤æ–· `a[i]` å’Œ `b[i]` çš„é—œä¿‚ï¼š
        - **åŒä¸€å€‹å­æ¨¹ (`parent[u] == parent[v]`)** â†’ å›å‚³ `1`
        - **çˆ¶å­é—œä¿‚ (`parent[u] == v or parent[v] == u`)** â†’ å›å‚³ `2`
        - **å¦å‰‡ (`0`)**ã€‚

---

## **ç‚ºä½•é€™æ¨£è§£ï¼Ÿ**

1. **O(n) å»ºæ¨¹ï¼ŒO(1) æŸ¥è©¢**
    
    - **BFS å»ºæ¨¹ `O(n)`**ï¼šå› ç‚ºæ¯å€‹ç¯€é»åªæœ‰ä¸€å€‹çˆ¶ç¯€é»ï¼Œéæ­· `n-1` æ¢é‚Šå³å¯å®Œæˆå»ºæ¨¹ã€‚
    - **æŸ¥è©¢ `O(1)`**ï¼šåªéœ€é€é `parent` è¡¨ä¾†æŸ¥æ‰¾ `O(1)` æ™‚é–“åˆ¤æ–·é—œä¿‚ã€‚
2. **é©ç”¨æ–¼è¼ƒå¤§æ•¸æ“šç¯„åœ**
    
    - è‹¥ç›´æ¥éæ­·æ¨¹ä¾†æª¢æŸ¥ç¯€é»é—œä¿‚ï¼Œæ¯æ¬¡ `O(n)`ï¼ŒæŸ¥è©¢ `m` æ¬¡å‰‡ `O(nm)`ï¼Œç„¡æ³•æ¥å—ã€‚
    - **é€é `parent` è¡¨ï¼Œæ‰€æœ‰æŸ¥è©¢æ™‚é–“å‡ç‚º `O(1)`**ï¼Œéå¸¸é«˜æ•ˆã€‚

---

## **è§£æ³•æ­¥é©Ÿ**

### **Step 1: æ§‹å»ºæ¨¹ (Graph Construction)**

ä½¿ç”¨ `x, y` ä¾†å»ºæ§‹ **é„°æ¥è¡¨ (Adjacency List)** `graph`ï¼š

- **ç„¡å‘æ¨¹** è¡¨ç¤ºæ³•ï¼š
    
    python
    
    è¤‡è£½ç·¨è¼¯
    
    `graph[u].add(v) graph[v].add(u)`
    

**ç¯„ä¾‹è¼¸å…¥**

text

è¤‡è£½ç·¨è¼¯

`x = [1, 1, 2, 2, 3] y = [2, 3, 4, 5, 6]`

è½‰æ›æˆé„°æ¥è¡¨ï¼š

text

è¤‡è£½ç·¨è¼¯

`{   1: {2, 3},   2: {1, 4, 5},   3: {1, 6},   4: {2},   5: {2},   6: {3} }`

---

### **Step 2: BFS å»ºç«‹ `parent` è¡¨**

æˆ‘å€‘å¾ `1` **ä½œç‚ºæ ¹ç¯€é» (Root)**ï¼Œä½¿ç”¨ **BFS (å»£åº¦å„ªå…ˆæœç´¢)** å»ºç«‹ **çˆ¶ç¯€é»è¡¨ `parent`**ï¼š

text

è¤‡è£½ç·¨è¼¯

`çˆ¶ç¯€é»è¡¨ï¼š {   1: None,  # æ ¹ç¯€é»æ²’æœ‰çˆ¶ç¯€é»   2: 1,   3: 1,   4: 2,   5: 2,   6: 3 }`

**BFS å»ºæ¨¹æ­¥é©Ÿ**

|è¨ªå•ç¯€é»|ä½‡åˆ—ç‹€æ…‹|è¨˜éŒ„ `parent`|
|---|---|---|
|`1` (èµ·é»)|`[2, 3]`|`{1: None}`|
|`2`|`[3, 4, 5]`|`{2: 1}`|
|`3`|`[4, 5, 6]`|`{3: 1}`|
|`4`|`[5, 6]`|`{4: 2}`|
|`5`|`[6]`|`{5: 2}`|
|`6`|`[]`|`{6: 3}`|

---

### **Step 3: æŸ¥è©¢ `a[i], b[i]` é—œä¿‚**

å°æ–¼æ¯å€‹ `(a[i], b[i])`ï¼š

1. è‹¥ `parent[u] == parent[v]`ï¼Œå›å‚³ `1`ï¼ˆ**åŒä¸€å€‹å­æ¨¹**ï¼‰ã€‚
2. è‹¥ `parent[u] == v or parent[v] == u`ï¼Œå›å‚³ `2`ï¼ˆ**çˆ¶å­é—œä¿‚**ï¼‰ã€‚
3. å¦å‰‡å›å‚³ `0`ï¼ˆ**ä¸åŒå­æ¨¹**ï¼‰ã€‚

#### **ç¯„ä¾‹æŸ¥è©¢**

text

è¤‡è£½ç·¨è¼¯

`a = [4, 5, 3] b = [5, 6, 2]`

å°æ‡‰ `parent` è¡¨æŸ¥è©¢ï¼š

|`(a, b)`|`parent[a]`|`parent[b]`|çµæœ|
|---|---|---|---|
|`(4, 5)`|`2`|`2`|`1` (åŒå­æ¨¹)|
|`(5, 6)`|`2`|`3`|`0` (ä¸åŒå­æ¨¹)|
|`(3, 2)`|`1`|`1`|`1` (åŒå­æ¨¹)|

æœ€çµ‚è¼¸å‡ºï¼š

text

è¤‡è£½ç·¨è¼¯

`[1, 0, 1]`

---

## **æ™‚é–“èˆ‡ç©ºé–“è¤‡é›œåº¦åˆ†æ**

### **æ™‚é–“è¤‡é›œåº¦**

|æ“ä½œ|è¤‡é›œåº¦|èªªæ˜|
|---|---|---|
|**æ§‹å»º `graph`**|`O(n)`|éœ€è¦éæ­· `n-1` æ¢é‚Š|
|**BFS å»ºç«‹ `parent` è¡¨**|`O(n)`|æ¯å€‹ç¯€é»æœ€å¤šè¢«è¨ªå•ä¸€æ¬¡|
|**æŸ¥è©¢ `m` æ¬¡**|`O(m)`|æ¯æ¬¡ `O(1)` æŸ¥è©¢|
|**ç¸½è¨ˆ**|`O(n + m)`|æŸ¥è©¢éå¸¸é«˜æ•ˆ|

### **ç©ºé–“è¤‡é›œåº¦**

|æ“ä½œ|ç©ºé–“è¤‡é›œåº¦|èªªæ˜|
|---|---|---|
|**é„°æ¥è¡¨ `graph`**|`O(n)`|å­˜å„² `n-1` æ¢é‚Š|
|**`parent` è¡¨**|`O(n)`|æ¯å€‹ç¯€é»å­˜å„² 1 å€‹å€¼|
|**ä½‡åˆ— `queue`**|`O(n)`|BFS éœ€è¦å­˜å„² `n` å€‹ç¯€é»|
|**ç¸½è¨ˆ**|`O(n)`|æ‰€æœ‰æ“ä½œå‡ç‚ºç·šæ€§|

---

## **å…¶ä»–è§£æ³• (ä¸å¯« Code)**

1. **DFS å»ºç«‹ `parent` è¡¨ (`O(n)`)**
    
    - ä½¿ç”¨ DFS ä¾†å»ºç«‹ `parent` è¡¨ï¼Œæ™‚é–“è¤‡é›œåº¦ç›¸åŒ (`O(n)`)ã€‚
    - **é©åˆéæ­¸æ“ä½œ**ï¼Œä½†éœ€è¦è€ƒæ…®**éæ­¸æ·±åº¦ (`O(n)`)**ã€‚
2. **ä¸¦æŸ¥é›† (Union-Find, `O(n log n)`)**
    
    - ä½¿ç”¨ **ä¸¦æŸ¥é›†** ä¾†æŸ¥æ‰¾ **å…¬å…±ç¥–å…ˆ**ï¼Œåˆ¤æ–·å…©è€…æ˜¯å¦åœ¨**åŒä¸€å€‹å­æ¨¹**ã€‚
    - è‹¥ `m` å¾ˆå¤§ï¼Œä¸¦æŸ¥é›†æœƒæ¯” `O(1)` æŸ¥è©¢æ…¢ã€‚
3. **æš´åŠ› DFS æŸ¥è©¢ (`O(nm)`)**
    
    - **æš´åŠ›è§£æ³•**ï¼šå°æ–¼æ¯å€‹ `(a[i], b[i])`ï¼Œä½¿ç”¨ DFS ä¾†åˆ¤æ–·æ˜¯å¦åœ¨åŒä¸€å­æ¨¹ã€‚
    - **ç¼ºé»**ï¼šç•¶ `m` å¾ˆå¤§æ™‚ï¼Œæ™‚é–“è¤‡é›œåº¦å¯èƒ½é”åˆ° `O(nm)`ï¼Œä¸å¯æ¥å—ã€‚

---

## **æœ€ä½³è§£æ³•**

âœ… **BFS å»º `parent` è¡¨ + O(1) æŸ¥è©¢ (`O(n + m)`)**

- **é«˜æ•ˆå»ºæ¨¹** (`O(n)`)
- **æŸ¥è©¢åƒ…éœ€ `O(1)`**ï¼Œé©åˆ **å¤§é‡æŸ¥è©¢** (`m` å¾ˆå¤§æ™‚) ğŸš€

---

**ç¸½çµ**ï¼š é€™é¡Œçš„ **æ ¸å¿ƒæ˜¯å»ºæ¨¹ (`O(n)`) + æŸ¥è©¢ (`O(1)`)**ï¼Œåˆ©ç”¨ **BFS å»º `parent` è¡¨** å¯ä»¥è®“æŸ¥è©¢è®Šå¾—è¶…å¿«ï¼ğŸ’¡