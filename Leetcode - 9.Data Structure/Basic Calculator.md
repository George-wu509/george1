
### **LintCode 978 基础计算器解法**

這題目要求實現一個簡單的計算器來計算包含整數、加法（`+`）、減法（`-`）、括號（`(` 和 `)`）的算術表達式。

#### **目标**

实现一个简单的计算器，支持以下功能：

- 整数计算（正数与负数）。
- 操作符 `+`、`-`。
- 括号 `(` 和 `)` 处理嵌套计算。

### 最小复杂度解法

#### **核心思路**

通过一个栈（`stack`）来管理括号嵌套，保持计算逻辑简单且高效。

**主要步骤：**

1. 使用 **一个栈** 记录括号内外的计算状态：
    - 当前的累积结果（`current_result`）。
    - 当前的符号（`current_sign`）。
2. 遍历输入字符串，逐个处理字符：
    - 遇到数字：累积读取完整数字。
    - 遇到符号：调整当前的符号。
    - 遇到左括号 `(`：将当前结果和符号入栈，开始新一层的计算。
    - 遇到右括号 `)`：将括号内的结果合并到上一层。
3. 返回最终结果。

---

#### 解法细节及复杂度

- **时间复杂度：** O(n)，每个字符只被处理一次。
- **空间复杂度：** O(h)，栈的最大深度为括号的嵌套深度 hhh。

---

### **解題思路**

這是一道經典的字符串處理與數學運算結合的題目。主要解題思路如下：

1. **使用棧模擬括號的計算順序：**
    
    - 括號會影響計算順序，最內層括號的表達式需要最先計算。
    - 棧結構（stack）是一種後進先出的結構，能很好地模擬括號的嵌套計算。
2. **逐字符解析字符串：**
    
    - 如果是數字，累積形成完整的數字。
    - 如果是加號或減號，將其應用於棧頂的計算狀態。
    - 如果遇到左括號，將當前狀態（結果和符號）存入棧，開始處理括號內的新狀態。
    - 如果遇到右括號，彈出棧頂的狀態，將括號內的結果與外層結果結合。
3. **符號的處理：**
    
    - `+` 和 `-` 符號需要結合當前計算結果，根據符號更新結果。
4. **計算結果：**
    
    - 需要遍歷完整的字符串，處理所有的括號，並在棧結構的幫助下累積計算結果。

Example:
样例 1
输入："1 + 1"
输出：2

样例 2
输入："(1+(4+5+2)-3)+(6+8)" 
输出：23

---

### **代碼步驟**

以下是 Python 實現的具體代碼及詳細注釋：

```python
def calculate(s: str) -> int:
    # 初始化變量
    stack = []  # 棧用於存儲 (當前結果, 當前符號)
    num = 0  # 用於累積數字
    result = 0  # 最終結果
    sign = 1  # 當前符號，1 表示正，-1 表示負

    for char in s:
        if char.isdigit():  # 如果是數字
            num = num * 10 + int(char)  # 構造完整數字
        elif char == '+':  # 如果是加號
            result += sign * num  # 把之前累積的數字根據符號加入結果
            num = 0  # 重置數字
            sign = 1  # 加號對應正號
        elif char == '-':  # 如果是減號
            result += sign * num  # 把之前累積的數字根據符號加入結果
            num = 0  # 重置數字
            sign = -1  # 減號對應負號
        elif char == '(':  # 如果是左括號
            # 將當前結果和符號壓入棧
            stack.append((result, sign))
            result = 0  # 括號內重置結果
            sign = 1  # 括號內默認符號為正
        elif char == ')':  # 如果是右括號
            result += sign * num  # 處理括號內的最後一個數字
            num = 0  # 重置數字
            prev_result, prev_sign = stack.pop()  # 彈出棧頂的狀態
            result = prev_result + prev_sign * result  # 結合括號內外的結果
        # 忽略空格
    # 處理最後一個數字
    result += sign * num
    return result

```
pass

---

### **步驟詳解及舉例**

#### 輸入：`"(1+(4+5+2)-3)+(6+8)"`

1. **初始化：**
    
    - `stack = []`
    - `num = 0`
    - `result = 0`
    - `sign = 1`
2. **逐字符解析：**
    
    - `char = '('`:
        - 把當前 `(result=0, sign=1)` 壓入棧，並初始化括號內的計算。
        - `stack = [(0, 1)]`
        - `result = 0`
        - `sign = 1`
    - `char = '1'`:
        - 累積數字 `num = 1`
    - `char = '+'`:
        - `result = result + sign * num = 0 + 1 * 1 = 1`
        - `num = 0`
        - `sign = 1`（加號）
    - `char = '('`:
        - 把當前 `(result=1, sign=1)` 壓入棧，初始化括號內的計算。
        - `stack = [(0, 1), (1, 1)]`
        - `result = 0`
        - `sign = 1`
    - `char = '4'`:
        - 累積數字 `num = 4`
    - `char = '+'`:
        - `result = result + sign * num = 0 + 1 * 4 = 4`
        - `num = 0`
        - `sign = 1`
    - `char = '5'`:
        - 累積數字 `num = 5`
    - `char = '+'`:
        - `result = result + sign * num = 4 + 1 * 5 = 9`
        - `num = 0`
        - `sign = 1`
    - `char = '2'`:
        - 累積數字 `num = 2`
    - `char = ')'`:
        - `result = result + sign * num = 9 + 1 * 2 = 11`
        - 從棧彈出 `(1, 1)`，更新外層結果。
        - `result = prev_result + prev_sign * result = 1 + 1 * 11 = 12`
        - `stack = [(0, 1)]`
    - `char = '-'`:
        - `result = result + sign * num = 12 - 1 * 3 = 9`
        - `num = 0`
        - `sign = -1`
    - `char = ')'`:
        - `result = result + sign * num = 12 + (-1) * 3 = 9`
        - 從棧彈出 `(0, 1)`，更新外層結果。
        - `result = prev_result + prev_sign * result = 0 + 1 * 9 = 9`
    - `char = '+'`:
        - `result = result + sign * num`
    - `char = '('`:
        - 把當前 `(result=9, sign=1)` 壓入棧。
        - `stack = [(9, 1)]`

---

最後得到計算結果 `23`。