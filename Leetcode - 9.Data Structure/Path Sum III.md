Lintcode 1240
ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œå®ƒçš„æ¯ä¸ªç»“ç‚¹éƒ½å­˜æ”¾ç€ä¸€ä¸ªæ•´æ•°å€¼ã€‚æ‰¾å‡ºè·¯å¾„å’Œç­‰äºç»™å®šæ•°å€¼çš„è·¯å¾„æ€»æ•°ã€‚
è·¯å¾„ä¸éœ€è¦ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä¹Ÿä¸éœ€è¦åœ¨å¶å­èŠ‚ç‚¹ç»“æŸï¼Œä½†æ˜¯è·¯å¾„æ–¹å‘å¿…é¡»æ˜¯å‘ä¸‹çš„ï¼ˆåªèƒ½ä»çˆ¶èŠ‚ç‚¹åˆ°å­èŠ‚ç‚¹ï¼‰ã€‚
äºŒå‰æ ‘ä¸è¶…è¿‡1000ä¸ªèŠ‚ç‚¹ï¼Œä¸”èŠ‚ç‚¹æ•°å€¼èŒƒå›´æ˜¯ [-1000000,1000000] çš„æ•´æ•°ã€‚

**æ ·ä¾‹ 1:**
```python
è¾“å…¥ï¼šroot = [10,5,-3,3,2,null,11,3,-2,null,1], sum = 8
è¾“å‡ºï¼š3
è§£é‡Šï¼š
      10
     /  \
    5   -3
   / \    \
  3   2   11
 / \   \
3  -2   1

è¿”å› 3ã€‚ å’Œä¸º8çš„è·¯å¾„ä¸º:

1.  5 -> 3
2.  5 -> 2 -> 1
3. -3 -> 11
```
**æ ·ä¾‹ 2:**
```python
è¾“å…¥ï¼šroot = [11,6,-3], sum = 17
è¾“å‡ºï¼š1
è§£é‡Šï¼š
      11
     /  \
    6   -3
è¿”å› 1ã€‚ å’Œä¸º17çš„è·¯å¾„ä¸º:

1.  11 -> 6
```


```python
def path_sum(self, root: TreeNode, sum: int) -> int:
	prefix = collections.defaultdict(int)
	prefix[0] = 1

	def dfs(root, curr):
		if not root:
			return 0
		
		ret = 0
		curr += root.val
		ret += prefix[curr - sum]
		prefix[curr] += 1
		ret += dfs(root.left, curr)
		ret += dfs(root.right, curr)
		prefix[curr] -= 1

		return ret

	return dfs(root, 0)
```
pass


# **LintCode 1240: Path Sum IIIï¼ˆè·¯å¾„æ€»å’Œ IIIï¼‰**

---

## **é¢˜ç›®æè¿°**

ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ `root` å’Œä¸€ä¸ªæ•´æ•° `sum`ï¼Œæ±‚**è·¯å¾„æ€»æ•°**ï¼Œä½¿å¾—æ¯æ¡è·¯å¾„ä¸Šçš„èŠ‚ç‚¹å€¼ä¹‹å’Œç­‰äº `sum`ã€‚  
è·¯å¾„å¯ä»¥ä»ä»»ä½•èŠ‚ç‚¹å¼€å§‹ï¼Œä¹Ÿå¯ä»¥åœ¨ä»»ä½•èŠ‚ç‚¹ç»“æŸï¼Œä½†å¿…é¡»æ˜¯**ä»çˆ¶èŠ‚ç‚¹åˆ°å­èŠ‚ç‚¹çš„è¿ç»­è·¯å¾„**ã€‚

---

## **ç¤ºä¾‹**
```python
è¾“å…¥:
       10
      /  \
     5   -3
    / \    \
   3   2   11
  / \   \
 3  -2   1
sum = 8

è¾“å‡º:
3

```
sum = 8  è¾“å‡º: 3`

**è§£é‡Š**ï¼š æ»¡è¶³è·¯å¾„å’Œç­‰äº `8` çš„è·¯å¾„æœ‰ï¼š

1. `[5, 3]`
2. `[5, 2, 1]`
3. `[-3, 11]`

---

## **è§£æ³•ï¼šå‰ç¼€å’Œ + DFSï¼ˆåŒæŒ‡é’ˆï¼‰**

### **æ ¸å¿ƒæ€è·¯**

4. **å‰ç¼€å’Œ**ï¼ˆPrefix Sumï¼‰
    
    - è®°å½•**ä»æ ¹èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„è·¯å¾„å’Œ**ã€‚
    - å¦‚æœåœ¨å½“å‰è·¯å¾„ä¸Šæœ‰ `prefix[curr] - sum` å‡ºç°ï¼Œåˆ™å­˜åœ¨ä¸€æ¡è·¯å¾„ä½¿å¾— `sum` æ°å¥½ç­‰äºç›®æ ‡å€¼ã€‚
5. **å“ˆå¸Œè¡¨å­˜å‚¨å‰ç¼€å’Œ**
    
    - ç»´æŠ¤ `prefix` è¿™ä¸ª **å“ˆå¸Œè¡¨ï¼ˆå­—å…¸ï¼‰** è®°å½•å·²è®¿é—®çš„è·¯å¾„å’Œçš„æ¬¡æ•°ã€‚
    - **`prefix[curr] - sum` åœ¨ `prefix` ä¸­çš„æ¬¡æ•°è¡¨ç¤ºæ»¡è¶³æ¡ä»¶çš„è·¯å¾„æ•°**ã€‚
6. **DFS éå†æ ‘**
    
    - **å‰åºéå†ï¼ˆPreorder DFSï¼‰**ï¼Œè®¡ç®—å½“å‰è·¯å¾„å’Œ `curr` å¹¶æ›´æ–° `prefix`ã€‚
    - **é€’å½’å·¦å­æ ‘** å’Œ **å³å­æ ‘**ã€‚
    - **å›æº¯**ï¼ˆBacktrackingï¼‰ï¼šåœ¨å›åˆ°ä¸Šå±‚æ—¶ï¼Œæ’¤é”€ `prefix[curr]` çš„ä¿®æ”¹ï¼Œç¡®ä¿ä¸å½±å“å…¶ä»–è·¯å¾„ã€‚

---

## **ä»£ç è§£æ**
```python
import collections

def path_sum(self, root: TreeNode, sum: int) -> int:
    prefix = collections.defaultdict(int)
    prefix[0] = 1  # è®°å½•åˆå§‹è·¯å¾„å’Œ0å‡ºç°1æ¬¡

    def dfs(root, curr):
        if not root:
            return 0
        
        ret = 0
        curr += root.val  # æ›´æ–°å½“å‰è·¯å¾„å’Œ

        # è®¡ç®—è·¯å¾„æ€»æ•°
        ret += prefix[curr - sum]  # æ‰¾åˆ°ä¹‹å‰è·¯å¾„å’Œä¸º curr - sum çš„æ¬¡æ•°

        # è®°å½•å½“å‰è·¯å¾„å’Œ
        prefix[curr] += 1
        
        # é€’å½’éå†å·¦å³å­æ ‘
        ret += dfs(root.left, curr)
        ret += dfs(root.right, curr)

        # å›æº¯ï¼Œæ’¤é”€å½“å‰è·¯å¾„å’Œçš„å½±å“
        prefix[curr] -= 1

        return ret

    return dfs(root, 0)

```
---

## **é€æ­¥æ‰§è¡Œåˆ†æ**

**è¾“å…¥**

`root = [10,5,-3,3,2,None,11,3,-2,None,1] sum = 8`

**æ ‘ç»“æ„**
```python
       10
      /  \
     5   -3
    / \    \
   3   2   11
  / \   \
 3  -2   1

```
### **æ‰§è¡Œ DFS éå†**

#### **åˆå§‹åŒ–**

|å˜é‡|å€¼|
|---|---|
|`prefix = {0: 1}`|è®°å½•è·¯å¾„å’Œ0å‡ºç°1æ¬¡|
|`curr = 0`|å½“å‰è·¯å¾„å’Œ|

---

#### **DFS é€’å½’æ­¥éª¤**

##### **éå† `10`**

- `curr = 10`
- `prefix = {0:1, 10:1}`
- **ç»§ç»­é€’å½’å·¦å­æ ‘ `5`**ã€‚

##### **éå† `5`**

- `curr = 10 + 5 = 15`
- `prefix = {0:1, 10:1, 15:1}`
- **ç»§ç»­é€’å½’å·¦å­æ ‘ `3`**ã€‚

##### **éå† `3`**

- `curr = 15 + 3 = 18`
- `prefix = {0:1, 10:1, 15:1, 18:1}`
- **æ‰¾åˆ° `prefix[curr - sum] = prefix[18 - 8] = prefix[10] = 1`**ï¼Œè·¯å¾„ `[5, 3]` **æ»¡è¶³æ¡ä»¶**ã€‚

##### **éå† `3`ï¼ˆå·¦å­æ ‘ï¼‰**

- `curr = 18 + 3 = 21`
- `prefix = {0:1, 10:1, 15:1, 18:1, 21:1}`
- **æ²¡æœ‰ç¬¦åˆçš„è·¯å¾„**ï¼Œå›æº¯ã€‚

##### **éå† `-2`**

- `curr = 18 - 2 = 16`
- `prefix = {0:1, 10:1, 15:1, 18:1, 16:1}`
- **æ²¡æœ‰ç¬¦åˆçš„è·¯å¾„**ï¼Œå›æº¯ã€‚

---

##### **éå† `2`ï¼ˆå³å­æ ‘ï¼‰**

- `curr = 15 + 2 = 17`
- `prefix = {0:1, 10:1, 15:1, 17:1}`
- **æ²¡æœ‰ç¬¦åˆçš„è·¯å¾„**ã€‚

##### **éå† `1`**

- `curr = 17 + 1 = 18`
- **æ‰¾åˆ° `prefix[18 - 8] = prefix[10] = 1`**ï¼Œè·¯å¾„ `[5, 2, 1]` **æ»¡è¶³æ¡ä»¶**ã€‚

---

##### **éå† `-3`ï¼ˆå³å­æ ‘ï¼‰**

- `curr = 10 - 3 = 7`
- **æ²¡æœ‰ç¬¦åˆçš„è·¯å¾„**ã€‚

##### **éå† `11`**

- `curr = 7 + 11 = 18`
- **æ‰¾åˆ° `prefix[18 - 8] = prefix[10] = 1`**ï¼Œè·¯å¾„ `[-3, 11]` **æ»¡è¶³æ¡ä»¶**ã€‚

æœ€ç»ˆï¼Œ**æ‰¾åˆ° 3 æ¡è·¯å¾„å’Œç­‰äº `8`**ï¼š

7. `[5, 3]`
8. `[5, 2, 1]`
9. `[-3, 11]`

è¿”å›ï¼š

`3`

---

## **æ—¶é—´ä¸ç©ºé—´å¤æ‚åº¦åˆ†æ**

10. **æ—¶é—´å¤æ‚åº¦**
    
    - **`O(n)`**ï¼šæ¯ä¸ªèŠ‚ç‚¹è®¿é—®ä¸€æ¬¡ï¼Œè¿›è¡Œ `O(1)` æ“ä½œã€‚
11. **ç©ºé—´å¤æ‚åº¦**
    
    - **`O(n)`**ï¼šæœ€åæƒ…å†µä¸‹ï¼Œå“ˆå¸Œè¡¨ `prefix` éœ€è¦å­˜å‚¨ `O(n)` ä¸ªè·¯å¾„å’Œã€‚

---

## **å…¶ä»–è§£æ³•**

### **1. æœ´ç´  DFSï¼ˆO(n^2)ï¼‰**

- **æ€è·¯**
    - å¯¹æ¯ä¸ªèŠ‚ç‚¹ï¼Œ**éå†æ‰€æœ‰å­è·¯å¾„** è®¡ç®—å’Œã€‚
    - **ç¼ºç‚¹**ï¼šæ¯ä¸ªèŠ‚ç‚¹éƒ½é€’å½’éå† `O(n)`ï¼Œæ€»å¤æ‚åº¦ **`O(n^2)`**ã€‚
```python
def path_sum(root, sum):
    if not root:
        return 0
    
    return count_paths(root, sum) + path_sum(root.left, sum) + path_sum(root.right, sum)

def count_paths(node, target):
    if not node:
        return 0

    return (1 if node.val == target else 0) + count_paths(node.left, target - node.val) + count_paths(node.right, target - node.val)

```

**æ—¶é—´å¤æ‚åº¦ `O(n^2)`ï¼Œç©ºé—´å¤æ‚åº¦ `O(1)`ã€‚**

---

## **æ–¹æ³•æ¯”è¾ƒ**

|æ–¹æ³•|æ—¶é—´å¤æ‚åº¦|ç©ºé—´å¤æ‚åº¦|é€‚ç”¨æƒ…å†µ|
|---|---|---|---|
|**å‰ç¼€å’Œ + DFSï¼ˆæœ€ä½³è§£æ³•ï¼‰**|`O(n)`|`O(n)`|**é€‚ç”¨äºå¤§è§„æ¨¡æ•°æ®**|
|æœ´ç´  DFS|`O(n^2)`|`O(1)`|**æ•°æ®é‡è¾ƒå°æ—¶å¯ç”¨**|

ğŸš€ **å‰ç¼€å’Œ `O(n)` è§£æ³•æ˜¯æœ€ä¼˜ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡æ•°æ®ï¼**