
NMS: <mark style="background: #FFF3A3A6;">RCNN series, YOLO series, SSD</mark>
No NMS: <mark style="background: #BBFABBA6;">No Anchor(CenterNet..), YOLOv10, DETR</mark>

è¨±å¤šç¾ä»£ç›®æ¨™æª¢æ¸¬æ¨¡å‹éƒ½åœ¨æ¨¡å‹å…§éƒ¨é›†æˆäº† NMSï¼Œä»¥æé«˜æ•ˆç‡ã€‚ä»¥ä¸‹æ˜¯æ‚¨åœ¨ä½¿ç”¨é€™äº›æ¨¡å‹æ™‚å¯èƒ½éœ€è¦é…ç½®çš„ç›¸é—œåƒæ•¸ï¼š

|                          | æ¨¡å‹å…§éƒ¨é›†æˆäº† NMS                        |                                                                                                                                                                                                                                    |
| ------------------------ | ---------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| YOLO                     | æ¨¡å‹çš„å¾Œè™•ç†éšæ®µæˆ–æª¢æ¸¬å±¤ä¸­                      | # èª¿æ•´ç½®ä¿¡åº¦é–¾å€¼<br>model.conf = 0.5  # åªä¿ç•™ç½®ä¿¡åº¦ >= 0.5 çš„æª¢æ¸¬æ¡†<br><br># èª¿æ•´ IoU é–¾å€¼<br>model.iou = 0.45 # NMS çš„ IoU é–¾å€¼<br><br># èª¿æ•´æœ€å¤§æª¢æ¸¬æ•¸é‡<br>model.max_det = 100 # æ¯å¼µåœ–ç‰‡æœ€å¤šä¿ç•™ 100 å€‹æª¢æ¸¬æ¡†                                                             |
| Faster RCNN<br>Mask RCNN | æ¨¡å‹çš„ RoI (Region of Interest) å¾Œè™•ç†éšæ®µ | # è¨­å®šç½®ä¿¡åº¦é–¾å€¼<br>cfg.MODEL.ROI_HEADS.SCORE_THRESH_TEST = 0.5<br><br># è¨­å®š IoU é–¾å€¼<br>cfg.MODEL.ROI_HEADS.NMS_THRESH_TEST = 0.45<br><br># è¨­å®šæœ€å¤§æª¢æ¸¬æ•¸é‡<br>cfg.MODEL.ROI_HEADS.DETECTIONS_PER_IMAGE = 100                                      |
| FCOS                     | æ¨¡å‹çš„å¾Œè™•ç†éšæ®µ                           | # è¨­å®šç½®ä¿¡åº¦é–¾å€¼<br>cfg.MODEL.ROI_HEADS.SCORE_THRESH_TEST = 0.5<br><br># è¨­å®š IoU é–¾å€¼<br>cfg.MODEL.ROI_HEADS.NMS_THRESH_TEST = 0.45<br><br># è¨­å®šæœ€å¤§æª¢æ¸¬æ•¸é‡<br>cfg.MODEL.ROI_HEADS.DETECTIONS_PER_IMAGE = 100                                      |
|                          |                                    |                                                                                                                                                                                                                                    |
|                          | NMSåœ¨æ¨¡å‹ä¹‹å¾Œè™•ç†                         |                                                                                                                                                                                                                                    |
| EfficientDet             | æ¨¡å‹çš„å¾Œè™•ç†éšæ®µ                           | predictions = model.predict(image)<br><br>detections = postprocess_boxes(<br>      predictions[0], image.shape[1], <br>      image.shape[2], score_threshold=0.5, <br>      iou_threshold=0.45,<br>      max_detection_points=100) |
| MobileNet-SSD            | æ¨¡å‹çš„å¾Œè™•ç†éšæ®µ                           |                                                                                                                                                                                                                                    |
|                          |                                    |                                                                                                                                                                                                                                    |



NMS: å°‡æ‰€æœ‰çš„æ¡†(boundary box)ä¾ç…§confidenceæ’åº, å…ˆé¸å‡ºæœ€é«˜confidenceæ¡†, ç„¶å¾Œè¨ˆç®—é€™å€‹æ¡†è·Ÿå…¶ä»–æ¡†çš„IoU, å¦‚æœé«˜æ–¼é–€æª»å‰‡åˆªé™¤. æ¥ä¸‹ä¾†å†ç¹¼çºŒä¸‹ä¸€å€‹ç¬¬äºŒé«˜confidenceæ¡† 

**AI ç‰©ä»¶åµæ¸¬æ¨¡å‹æ˜¯å¦æœ‰çš„ AI æ¨¡å‹å¾—åˆ°çµæœä¹‹å¾Œé‚„éœ€è¦ç”¨ NMSï¼Ÿ**

æ˜¯çš„ï¼Œè¨±å¤šä¸»æµçš„ AI ç‰©ä»¶åµæ¸¬æ¨¡å‹åœ¨å¾—åˆ°åˆæ­¥çš„é æ¸¬çµæœå¾Œï¼Œé€šå¸¸**éœ€è¦**ä½¿ç”¨éæ¥µå¤§å€¼æŠ‘åˆ¶ï¼ˆNMSï¼‰ä¾†é€²è¡Œå¾Œè™•ç†ã€‚é€™æ˜¯å› ç‚ºæ¨¡å‹å¯èƒ½æœƒå°åŒä¸€å€‹ç‰©é«”ç”¢ç”Ÿå¤šå€‹é‡ç–Šçš„é æ¸¬æ¡†ã€‚NMS çš„ä½œç”¨å°±æ˜¯å¾é€™äº›é‡ç–Šçš„é æ¸¬æ¡†ä¸­é¸æ“‡å‡ºæœ€å„ªçš„ä¸€å€‹ï¼Œä¸¦æŠ‘åˆ¶æ‰å…¶é¤˜çš„å†—é¤˜æ¡†ã€‚

ç„¶è€Œï¼Œè¿‘å¹´ä¾†ä¹Ÿå‡ºç¾äº†ä¸€äº›**ä¸éœ€è¦** NMS çš„ç‰©ä»¶åµæ¸¬æ¨¡å‹ã€‚é€™äº›æ¨¡å‹é€šå¸¸æ¡ç”¨ä¸åŒçš„é æ¸¬å’ŒåŒ¹é…æ©Ÿåˆ¶ï¼Œä¾‹å¦‚ç›´æ¥é æ¸¬ç‰©é«”çš„ä¸­å¿ƒé»å’Œå°ºå¯¸ï¼Œä¸¦ä½¿ç”¨ä¸€å°ä¸€çš„åŒ¹é…ç­–ç•¥ï¼Œå¾è€Œåœ¨æ¨¡å‹æ¶æ§‹ä¸Šé¿å…äº†ç”¢ç”Ÿå¤§é‡é‡ç–Šæ¡†çš„å¯èƒ½æ€§ï¼Œå› æ­¤åœ¨å¾Œè™•ç†éšæ®µä¹Ÿå°±ä¸éœ€è¦ NMSã€‚

**æœ‰å“ªäº›å¸¸ç”¨ AI based object detection model éœ€è¦ NMS, é‚£äº›ä¸éœ€è¦?**

**éœ€è¦ NMS çš„å¸¸ç”¨æ¨¡å‹ï¼š**

- **åŸºæ–¼éŒ¨æ¡†ï¼ˆAnchor-basedï¼‰çš„æ¨¡å‹ï¼š**
    - **R-CNN ç³»åˆ— (R-CNN, Fast R-CNN, Faster R-CNN)ï¼š** é€™äº›æ˜¯ç¶“å…¸çš„å…©éšæ®µåµæ¸¬å™¨ï¼Œæœƒå…ˆç”Ÿæˆå€™é¸å€åŸŸï¼Œç„¶å¾Œå°é€™äº›å€åŸŸé€²è¡Œåˆ†é¡å’Œé‚Šç•Œæ¡†å›æ­¸ã€‚ç”±æ–¼éŒ¨æ¡†çš„è¨­è¨ˆï¼Œå¯èƒ½å°åŒä¸€å€‹ç‰©é«”ç”¢ç”Ÿå¤šå€‹å€™é¸æ¡†ï¼Œå› æ­¤éœ€è¦ NMS ä¾†ç¯©é¸ã€‚
    - **YOLO ç³»åˆ— (YOLOv1, YOLOv2, YOLOv3, YOLOv4, YOLOv5, YOLOv7, YOLOv8 ç­‰)ï¼š** YOLO æ˜¯ä¸€ç¨®å–®éšæ®µåµæ¸¬å™¨ï¼Œå®ƒå°‡åœ–åƒåŠƒåˆ†ç‚ºç¶²æ ¼ï¼Œä¸¦åœ¨æ¯å€‹ç¶²æ ¼å–®å…ƒä¸­é æ¸¬å¤šå€‹å¸¶æœ‰ä¸åŒå°ºå¯¸å’Œæ¯”ä¾‹çš„éŒ¨æ¡†ã€‚å› æ­¤ï¼Œå°æ–¼åŒä¸€å€‹ç‰©é«”ï¼Œå¯èƒ½æœƒæœ‰å¤šå€‹éŒ¨æ¡†è¢«é æ¸¬ç‚ºåŒ…å«è©²ç‰©é«”ï¼Œéœ€è¦ NMS ä¾†å»é™¤å†—é¤˜æ¡†ã€‚
    - **SSD (Single Shot MultiBox Detector)ï¼š** é¡ä¼¼æ–¼ YOLOï¼ŒSSD ä¹Ÿæ˜¯ä¸€ç¨®å–®éšæ®µåµæ¸¬å™¨ï¼Œå®ƒåœ¨ä¸åŒå°ºåº¦çš„ç‰¹å¾µåœ–ä¸Šä½¿ç”¨ä¸€ç³»åˆ—é å®šç¾©çš„éŒ¨æ¡†é€²è¡Œé æ¸¬ï¼Œå› æ­¤ä¹Ÿéœ€è¦ NMSã€‚
    - **RetinaNetï¼š** é€™æ˜¯ä¸€ç¨®å–®éšæ®µåµæ¸¬å™¨ï¼Œæ—¨åœ¨è§£æ±ºå–®éšæ®µåµæ¸¬å™¨åœ¨è¨“ç·´éç¨‹ä¸­å‰æ™¯-èƒŒæ™¯é¡åˆ¥ä¸å¹³è¡¡çš„å•é¡Œã€‚å®ƒä¾ç„¶åŸºæ–¼éŒ¨æ¡†é€²è¡Œé æ¸¬ï¼Œå› æ­¤éœ€è¦ NMSã€‚

**ä¸éœ€è¦ NMS çš„å¸¸ç”¨æ¨¡å‹ï¼ˆæˆ–æ­£åœ¨ç™¼å±•æ­¤æ–¹å‘çš„æ¨¡å‹ï¼‰ï¼š**

- **åŸºæ–¼ä¸­å¿ƒé»ï¼ˆCenter-basedï¼‰çš„æ¨¡å‹ï¼š**
    
    - **CenterNetï¼š** é€™å€‹æ¨¡å‹å°‡æ¯å€‹ç‰©é«”è¦–ç‚ºä¸€å€‹é»â€”â€”å…¶é‚Šç•Œæ¡†çš„ä¸­å¿ƒé»ã€‚æ¨¡å‹é æ¸¬æ¯å€‹ç‰©é«”çš„ä¸­å¿ƒé»heatmapï¼Œä»¥åŠåˆ°å…¶é‚Šç•Œæ¡†é‚Šç·£çš„åç§»é‡ã€‚ç”±æ–¼æ¯å€‹ç‰©é«”åªé æ¸¬ä¸€å€‹ä¸­å¿ƒé»ï¼Œå› æ­¤åœ¨å¾Œè™•ç†ä¸­ä¸éœ€è¦ NMS ä¾†å»é™¤é‡è¤‡æ¡†ã€‚å®ƒé€šå¸¸é€šéæå– heatmap çš„å±€éƒ¨å³°å€¼ä¾†ç¢ºå®šç‰©é«”ä¸­å¿ƒã€‚
    - **Objects as Points (ExtremeNet çš„åŸºç¤)ï¼š** é€™å€‹æ–¹æ³•ä¹Ÿé æ¸¬ç‰©é«”çš„ä¸­å¿ƒé»å’Œå…¶ä»–é—œéµé»ï¼Œä¸¦å°‡å®ƒå€‘çµ„åˆèµ·ä¾†å½¢æˆé‚Šç•Œæ¡†ï¼Œé¿å…äº†ä½¿ç”¨éŒ¨æ¡†å’Œ NMSã€‚
    - **YOLOv10ï¼š** æœ€æ–°çš„ YOLO ç‰ˆæœ¬ YOLOv10 æ­£åœ¨æ¢ç´¢å’Œæ¡ç”¨ç„¡ NMS çš„è¨“ç·´æ–¹æ³•ï¼Œæ—¨åœ¨æé«˜æ¨ç†é€Ÿåº¦ã€‚
- **åŸºæ–¼ Transformer çš„æ¨¡å‹ï¼š**
    
    - **DETR (DEtection TRansformer)ï¼š** DETR æ˜¯ä¸€ç¨®é–‹å‰µæ€§çš„ä½¿ç”¨ Transformer é€²è¡Œç‰©ä»¶åµæ¸¬çš„æ¨¡å‹ã€‚å®ƒç›´æ¥é æ¸¬ä¸€çµ„å›ºå®šæ•¸é‡çš„ç‰©é«”é‚Šç•Œæ¡†ï¼Œä¸¦ä½¿ç”¨äºŒåˆ†åŒ¹é…ï¼ˆBipartite Matchingï¼‰å°‡é æ¸¬çµæœèˆ‡çœŸå¯¦æ¨™è¨»é€²è¡ŒåŒ¹é…ã€‚ç”±æ–¼å…¶é æ¸¬æ˜¯ç›´æ¥ä¸”å”¯ä¸€çš„ï¼Œå› æ­¤åœ¨æ¨ç†éšæ®µä¸éœ€è¦ NMSã€‚
    - **Deformable DETR åŠå…¶å¾ŒçºŒç‰ˆæœ¬ (å¦‚ DINO)ï¼š** é€™äº›æ¨¡å‹åœ¨ DETR çš„åŸºç¤ä¸Šé€²è¡Œäº†æ”¹é€²ï¼Œä½†ä»ç„¶ä¿ç•™äº†åŸºæ–¼ Transformer çš„æ¶æ§‹å’ŒäºŒåˆ†åŒ¹é…çš„ç‰¹æ€§ï¼Œå› æ­¤ä¹Ÿä¸éœ€è¦ NMSã€‚

**è«‹ç¹é«”ä¸­æ–‡è§£é‡‹ç”šéº¼æ˜¯ NMSï¼ˆNon-Maximum Suppressionï¼‰**

**éæ¥µå¤§å€¼æŠ‘åˆ¶ï¼ˆNon-Maximum Suppressionï¼Œç°¡ç¨± NMSï¼‰** æ˜¯ä¸€ç¨®åœ¨ç‰©ä»¶åµæ¸¬ä»»å‹™ä¸­å¸¸ç”¨çš„**å¾Œè™•ç†æŠ€è¡“**ã€‚<mark style="background: #FFF3A3A6;">ç•¶ä¸€å€‹è¨“ç·´å¥½çš„ç‰©ä»¶åµæ¸¬æ¨¡å‹å°ä¸€å¼µåœ–ç‰‡é€²è¡Œé æ¸¬æ™‚ï¼Œå¯èƒ½æœƒå°åŒä¸€å€‹ç‰©é«”ç”¢ç”Ÿå¤šå€‹é‚Šç•Œæ¡†ï¼ˆbounding boxï¼‰ã€‚é€™äº›é‚Šç•Œæ¡†å¯èƒ½å½¼æ­¤é‡ç–Š</mark>ï¼Œä¸¦ä¸”éƒ½å¸¶æœ‰ä¸€å€‹**ç½®ä¿¡åº¦åˆ†æ•¸**ï¼ˆconfidence scoreï¼‰ï¼Œè¡¨ç¤ºæ¨¡å‹èªç‚ºé€™å€‹æ¡†å…§åŒ…å«ç‰¹å®šç‰©é«”çš„å¯èƒ½æ€§æœ‰å¤šå¤§ã€‚

NMS çš„ç›®æ¨™æ˜¯**å¾é€™äº›é‡ç–Šçš„é æ¸¬æ¡†ä¸­é¸æ“‡å‡ºæœ€å„ªçš„ä¸€å€‹**ï¼Œä¸¦**æŠ‘åˆ¶ï¼ˆå»é™¤ï¼‰æ‰å…¶é¤˜çš„å†—é¤˜æ¡†**ï¼Œå¾è€Œç¢ºä¿æ¯å€‹çœŸå¯¦çš„ç‰©é«”åªè¢«ä¸€å€‹æœ€æº–ç¢ºçš„é‚Šç•Œæ¡†æ¨™è¨»å‡ºä¾†ã€‚

NMS çš„å…¸å‹é‹ä½œæ­¥é©Ÿå¦‚ä¸‹ï¼š

1. **æ ¹æ“šç½®ä¿¡åº¦åˆ†æ•¸å°æ‰€æœ‰çš„é æ¸¬æ¡†é€²è¡Œæ’åº**ï¼Œå°‡ç½®ä¿¡åº¦æœ€é«˜çš„æ¡†æ”¾åœ¨æœ€å‰é¢ã€‚
2. **é¸æ“‡ç½®ä¿¡åº¦æœ€é«˜çš„é æ¸¬æ¡†**ï¼Œä¸¦å°‡å…¶åŠ å…¥åˆ°æœ€çµ‚çš„åµæ¸¬çµæœåˆ—è¡¨ä¸­ã€‚
3. **è¨ˆç®—é€™å€‹è¢«é¸ä¸­çš„é æ¸¬æ¡†èˆ‡å…¶é¤˜æ‰€æœ‰é æ¸¬æ¡†ä¹‹é–“çš„é‡ç–Šç¨‹åº¦**ï¼ˆé€šå¸¸ä½¿ç”¨**äº¤ä¸¦æ¯”ï¼ŒIntersection over Unionï¼ŒIoU** ä¾†è¡¡é‡ï¼‰ã€‚IoU çš„å€¼è¶Šé«˜ï¼Œè¡¨ç¤ºå…©å€‹æ¡†çš„é‡ç–Šç¨‹åº¦è¶Šå¤§ã€‚
4. **å°æ–¼æ‰€æœ‰èˆ‡ç•¶å‰é¸ä¸­æ¡†çš„ IoU å€¼å¤§æ–¼æŸå€‹é å…ˆè¨­å®šçš„é–¾å€¼ï¼ˆä¾‹å¦‚ 0.5ï¼‰çš„é æ¸¬æ¡†ï¼Œå°‡å®ƒå€‘å¾å¾…è™•ç†çš„é æ¸¬æ¡†åˆ—è¡¨ä¸­ç§»é™¤**ã€‚é€™æ˜¯å› ç‚ºé€™äº›æ¡†å¾ˆå¯èƒ½éƒ½æ˜¯æª¢æ¸¬åˆ°åŒä¸€å€‹ç‰©é«”ï¼Œè€Œæˆ‘å€‘å·²ç¶“é¸æ“‡äº†ç½®ä¿¡åº¦æœ€é«˜çš„é‚£å€‹ã€‚
5. **é‡è¤‡æ­¥é©Ÿ 2-4**ï¼Œç›´åˆ°å¾…è™•ç†çš„é æ¸¬æ¡†åˆ—è¡¨ç‚ºç©ºã€‚
6. **æœ€çµ‚åµæ¸¬çµæœåˆ—è¡¨ä¸­çš„æ¡†å°±æ˜¯ç¶“é NMS è™•ç†å¾Œå¾—åˆ°çš„ã€æ¯å€‹ç‰©é«”ä¸€å€‹çš„æœ€ä½³é æ¸¬æ¡†ã€‚**

**ç¸½çµä¾†èªªï¼ŒNMS çš„ä½œç”¨æ˜¯å»é™¤ç‰©ä»¶åµæ¸¬æ¨¡å‹ç”¢ç”Ÿçš„å†—é¤˜å’Œé‡ç–Šçš„é æ¸¬æ¡†ï¼Œä¿ç•™æœ€å¯ä¿¡çš„é æ¸¬çµæœï¼Œå¾è€Œæé«˜åµæ¸¬çµæœçš„æº–ç¢ºæ€§å’Œå¯è®€æ€§ã€‚**




# ä¸€ã€ä»€éº¼æ˜¯ NMSï¼ˆNon-Maximum Suppressionï¼‰ï¼Ÿ

NMS æ˜¯ **éæ¥µå¤§å€¼æŠ‘åˆ¶**ï¼Œåœ¨ç‰©ä»¶åµæ¸¬ä¸­å¸¸ç”¨ä¾†**æ¶ˆé™¤å¤šé¤˜é‡ç–Šçš„é æ¸¬æ¡†**ã€‚

### ğŸ“Œ ç‚ºä»€éº¼éœ€è¦ NMSï¼Ÿ

å¤§å¤šæ•¸ç‰©ä»¶åµæ¸¬æ¨¡å‹ï¼ˆå°¤å…¶æ˜¯ anchor-basedï¼‰æœƒå°åŒä¸€å€‹ç‰©ä»¶ç”¢ç”Ÿå¤šå€‹é‡ç–Šæ¡†


# âœ… äºŒã€NMS çš„å…·é«”æµç¨‹æ˜¯ä»€éº¼ï¼Ÿ

å‡è¨­ä½ æœ‰å¤šå€‹é æ¸¬æ¡†ï¼Œæ¯å€‹éƒ½æœ‰ä¸€å€‹ä¿¡å¿ƒåˆ†æ•¸ï¼ˆscoreï¼‰èˆ‡åº§æ¨™ï¼š

### ğŸ“Œ NMS è™•ç†æ­¥é©Ÿï¼š

1. **å°‡æ‰€æœ‰é æ¸¬æ¡†æŒ‰ score å¾é«˜åˆ°ä½æ’åº**ã€‚
    
2. **é¸å–æœ€é«˜åˆ†æ¡† Aï¼Œä¿ç•™ä½œç‚ºè¼¸å‡º**ã€‚
    
3. **è¨ˆç®—å…¶é¤˜æ‰€æœ‰æ¡†èˆ‡ A çš„ IoU**ï¼š
    
    - å¦‚æœ IoU â‰¥ NMS é–€æª»ï¼ˆå¦‚ 0.5ï¼‰ï¼Œå‰‡**åˆªé™¤é€™äº›é‡ç–Šçš„æ¡†**ã€‚
        
4. é‡è¤‡æ­¥é©Ÿ 2~3ï¼Œç›´åˆ°æ²’æœ‰æ¡†ç‚ºæ­¢ã€‚
    

é€™æ¨£ä¿è­‰ï¼š

- **å°æ¯å€‹ç‰©ä»¶åªä¿ç•™ä¸€å€‹æœ€ä½³æ¡†**
    
- **é¿å…é‡è¤‡é æ¸¬**
    

---

# âœ… ä¸‰ã€å“ªäº›æ¨¡å‹éœ€è¦ NMSï¼Ÿ

|æ¨¡å‹é¡å‹|æ˜¯å¦ä½¿ç”¨ Anchor|æ˜¯å¦éœ€è¦ NMSï¼Ÿ|åŸå› èªªæ˜|
|---|---|---|---|
|**Faster R-CNN**|âœ… æœ‰|âœ… éœ€è¦ NMSï¼ˆ2 æ¬¡ï¼‰|Proposal è·Ÿ Final é æ¸¬éƒ½æœƒé‡è¤‡é æ¸¬|
|**RetinaNet**|âœ… æœ‰|âœ… éœ€è¦|å°æ¯å€‹ anchor è¼¸å‡ºé æ¸¬ï¼Œæ•¸é‡é¾å¤§ä¸”é‡ç–Š|
|**SSD / YOLO v1~v4**|âœ… æœ‰|âœ… éœ€è¦|æ¯æ ¼ä½ç½®å¯èƒ½é æ¸¬å¤šç‰©ä»¶ï¼Œå¤š anchor å°è‡´é‡è¤‡é æ¸¬|
|**FCOS / CenterNet**|âŒ ç„¡|âœ… é€šå¸¸ä»æœƒç”¨|é›–ç„¶ anchor-freeï¼Œä½†ä¸€å¼µåœ–çš„åƒç´ æœƒé æ¸¬å¤šå€‹ bbox|
|**DETR / Deformable DETR**|âŒ ç„¡|âŒ ä¸éœ€è¦|ä½¿ç”¨å›ºå®šæ•¸é‡çš„ object queries ä¸”é€é matching é¿å…é‡ç–Šé æ¸¬|

---

# âœ… å››ã€NMS åœ¨æ¨¡å‹ä¸­åœ¨å“ªä¸€æ­¥åŸ·è¡Œï¼Ÿï¼ˆä»¥ Faster R-CNN ç‚ºä¾‹ï¼‰

### ğŸ” æµç¨‹åœ–ï¼š

text

è¤‡è£½ç·¨è¼¯

`è¼¸å…¥åœ–åƒ  â†’ Backbone + FPN  â†’ RPNï¼ˆç”¢ç”Ÿæ•¸åƒå€‹ anchorï¼‰  â†’ å›æ­¸ä¿®æ­£ â†’ Proposalï¼ˆé‚„æ˜¯æ•¸åƒå€‹æ¡†ï¼‰  â†’ ğŸ”¶ NMSï¼ˆç¬¬ä¸€æ¬¡ï¼Œä¿ç•™ Top-N Proposalï¼‰  â†’ RoIAlign  â†’ Classification + BBox Regression  â†’ ğŸ”¶ NMSï¼ˆç¬¬äºŒæ¬¡ï¼Œéæ¿¾æœ€çµ‚è¼¸å‡ºé‡ç–Šæ¡†ï¼‰`

---

### âœ… NMS åœ¨å“ªå…©å€‹éšæ®µåŸ·è¡Œï¼Ÿ

|éšæ®µ|NMS æ˜¯å¦ä½¿ç”¨|èªªæ˜|
|---|---|---|
|**RPN éšæ®µï¼ˆç¬¬ä¸€æ¬¡ï¼‰**|âœ…|å¾ä¸Šè¬å€‹ anchor proposals ä¸­ä¿ç•™ top-N|
|**æœ€çµ‚è¼¸å‡ºï¼ˆç¬¬äºŒæ¬¡ï¼‰**|âœ…|å¾ classification head é æ¸¬çµæœä¸­ï¼Œéæ¿¾åŒé¡åˆ¥é‡ç–Šçš„æ¡†|

---

## âœ… èˆ‰ä¾‹èªªæ˜ï¼šFaster R-CNN çš„ NMS æ‡‰ç”¨

å‡è¨­è¼¸å…¥ä¸€å¼µåœ–ç‰‡ï¼Œæ¨¡å‹é æ¸¬ä¸‹åˆ—æ¡†ï¼ˆåŒä¸€é¡åˆ¥ï¼‰ï¼š

|é æ¸¬æ¡† ID|Score|IoUï¼ˆç›¸å°æ–¼æ¡† #1ï¼‰|
|---|---|---|
|1|0.95|--|
|2|0.90|0.75|
|3|0.85|0.60|
|4|0.70|0.40|

è‹¥ NMS é–€æª»è¨­ç‚º 0.5ï¼š

- æ¡† 1 è¢«ä¿ç•™ï¼ˆscoreæœ€é«˜ï¼‰
    
- æ¡† 2 IoU=0.75 â†’ ç§»é™¤ï¼ˆå› ç‚ºèˆ‡æ¡†1é‡ç–Šå¤ªå¤šï¼‰
    
- æ¡† 3 IoU=0.60 â†’ ç§»é™¤
    
- æ¡† 4 IoU=0.40 â†’ ä¿ç•™
    

è¼¸å‡ºç‚ºæ¡† 1 å’Œ 4ï¼ŒæˆåŠŸæ¶ˆé™¤é‡è¤‡åµæ¸¬ã€‚

---

## âœ… ç‚ºä»€éº¼ **DETR ä¸éœ€è¦ NMSï¼Ÿ**

|æ¨¡å‹|è¼¸å‡ºæ–¹å¼|ç‚ºä½•ä¸éœ€è¦ NMS|
|---|---|---|
|**DETR**|ä½¿ç”¨å›ºå®šæ•¸é‡ï¼ˆä¾‹å¦‚ 100 å€‹ï¼‰çš„ Object Queriesï¼Œè¼¸å‡ºå›ºå®šæ•¸é‡é æ¸¬æ¡†|æ¡ç”¨ **Hungarian Matching** æ¼”ç®—æ³•ï¼Œå°‡æ¯å€‹ query èˆ‡ ground truth é€²è¡Œä¸€ä¸€æœ€ä½³é…å°ï¼Œä¸”é æ¸¬åˆ†æ•£ï¼Œç„¡éœ€éæ¿¾é‡ç–Š|

é€™ç¨®è¨­è¨ˆæœ¬è³ªä¸Šå°±**é¿å…äº†å¤šæ¡†é æ¸¬åŒä¸€ç‰©ä»¶çš„æƒ…æ³**ï¼Œå› æ­¤ä¸éœ€è¦ NMSã€‚

---

# âœ… å°çµ

| å•é¡Œ                       | è§£é‡‹                                                                  |
| ------------------------ | ------------------------------------------------------------------- |
| æœ‰ Anchor çš„æ¨¡å‹æ˜¯å¦ä¸€å®šéœ€è¦ NMSï¼Ÿ  | âœ… **å¹¾ä¹éƒ½éœ€è¦**ï¼Œå› ç‚ºæœƒå°åŒä¸€ç‰©ä»¶ç”¢ç”Ÿå¤šå€‹é æ¸¬æ¡†                                         |
| æ²’æœ‰ Anchor çš„æ¨¡å‹æ˜¯å¦å°±ä¸éœ€è¦ NMSï¼Ÿ | âŒ **ä¸ä¸€å®š**ï¼Œå¦‚ FCOS é‚„æ˜¯æœƒå°åŒä¸€ç‰©ä»¶é æ¸¬å¤šæ¡†ï¼Œéœ€è¦ NMS è™•ç†ï¼›ä½† **DETR å› è¨­è¨ˆé¿å…é‡è¤‡é æ¸¬ï¼Œ**ä¸éœ€ NMS |
| NMS åœ¨æ¨¡å‹ä¸­å“ªè£¡ä½¿ç”¨ï¼Ÿ            | 1. RPN Proposal å¾Œï¼›2. Final é æ¸¬è¼¸å‡ºå‰                                    |





## âœ… è¡¨æ ¼æ•´ç†ï¼šå„æ¨¡å‹ NMS ä½œç”¨ä½ç½®

|**æ¨¡å‹åç¨±**|**æ˜¯å¦ä½¿ç”¨ Anchorï¼Ÿ**|**æ˜¯å¦ä½¿ç”¨ NMSï¼Ÿ**|**NMS ç”¨é€”èˆ‡ä½ç½®**|
|---|---|---|---|
|**YOLO v1â€“v4**|âœ… æ˜¯|âœ… ä½¿ç”¨|**è¼¸å‡ºéšæ®µä½¿ç”¨**ï¼Œç¯©é¸æ‰é‡ç–Šçš„é«˜åˆ†æ¡†ï¼Œä¿ç•™æ¯é¡åˆ¥æœ€ä½³æ¡†|
|**YOLO v5â€“v8**|âŒï¼ˆv8ç‚º Anchor-Freeï¼‰|âœ… ä½¿ç”¨|**æœ€çµ‚é æ¸¬éšæ®µä½¿ç”¨**ï¼Œåœ¨æ¯å€‹ grid cell æˆ–ä¸­å¿ƒé»é æ¸¬å¾Œå»é™¤é‡è¤‡æ¡†|
|**FCOS**|âŒ å¦|âœ… ä½¿ç”¨|**åƒç´ ç´šé æ¸¬å¾Œä½¿ç”¨**ï¼Œå› ç‚ºæ¯å€‹åƒç´ å¯é æ¸¬ä¸€æ¡†ï¼Œéœ€ç”¨ NMS é¿å…å¤§é‡é‡ç–Šæ¡†|
|**EfficientDet**|âœ… æ˜¯|âœ… ä½¿ç”¨|**RPN æœ€çµ‚é æ¸¬éšæ®µä½¿ç”¨**ï¼Œå¤§é‡ anchor é æ¸¬å¾Œéœ€é€²è¡Œ NMS éæ¿¾é‡è¤‡ç‰©ä»¶|
|**MobileNet-SSD**|âœ… æ˜¯|âœ… ä½¿ç”¨|**è¼¸å‡ºéšæ®µä½¿ç”¨**ï¼Œèˆ‡ YOLO é¡ä¼¼ï¼Œå¾æ‰€æœ‰é æ¸¬æ¡†ä¸­ç¯©é¸å‡ºæœ€å¯èƒ½æ­£ç¢ºä¸”ä¸é‡ç–Šçš„|
|**DETR**|âŒ å¦ï¼ˆç„¡ Anchorï¼‰|âŒ ä¸ä½¿ç”¨|ä¸éœ€ NMSï¼Œä½¿ç”¨ **Hungarian Matching** ä¸€ä¸€é…å° Ground Truthï¼Œè‡ªå‹•å­¸æœƒé¿å…é‡è¤‡é æ¸¬|
|**Deformable DETR**|âŒ å¦|âŒ ä¸ä½¿ç”¨|åŒ DETRï¼Œä¾é  matching è¨“ç·´ç­–ç•¥è‡ªå‹•æ¶ˆé™¤é‡è¤‡é æ¸¬|

---

## âœ… NMS é‹ä½œçš„ä½ç½®è¦–è¦ºåŒ–èªªæ˜ï¼š

text

è¤‡è£½ç·¨è¼¯

`ã€YOLO / SSD / FCOS / EfficientDetã€‘    é æ¸¬éšæ®µï¼ˆæ‰€æœ‰ä½ç½®é æ¸¬æ•¸åƒæ¡†ï¼‰         â†“    NMS éæ¿¾ï¼ˆä¿ç•™ä¸é‡ç–Šçš„é«˜åˆ†æ¡†ï¼‰         â†“    è¼¸å‡ºçµæœ  ã€DETR / Deformable DETRã€‘    é æ¸¬å›ºå®šæ•¸é‡çš„ object queriesï¼ˆä¾‹å¦‚ 100 å€‹ï¼‰         â†“    æ¯å€‹é æ¸¬èˆ‡ GT é…å°ï¼ˆHungarian Matchingï¼‰         â†“    è¼¸å‡ºçµæœï¼ˆç„¡éœ€ NMSï¼‰`

---

## âœ… å°çµèˆ‡å°æ¯”

|æ¨¡å‹é¡å‹|æ˜¯å¦éœ€è¦ NMS|åŸå› èˆ‡æƒ…å¢ƒèªªæ˜|
|---|---|---|
|**Anchor-Based**ï¼ˆå¦‚ YOLOv4, EfficientDet, SSDï¼‰|âœ… éœ€è¦|å¤§é‡ anchor é æ¸¬æ¡†é‡ç–Šï¼Œéœ€ NMS ç¯©é¸|
|**Anchor-Free**ï¼ˆå¦‚ FCOSï¼‰|âœ… é€šå¸¸éœ€è¦|é›–ç„¡ anchorï¼Œä½†æ¯åƒç´ é æ¸¬ä»å¯èƒ½é‡ç–Š|
|**Query-Based**ï¼ˆå¦‚ DETRï¼‰|âŒ ä¸éœ€è¦|è¨“ç·´éç¨‹é€éåŒ¹é…æ©Ÿåˆ¶ï¼Œè‡ªå‹•å­¸æœƒä¸é‡è¤‡é æ¸¬|

---

## âœ… å»ºè­°ç”¨é€”ï¼ˆæ˜¯å¦ä¿ç•™ NMSï¼‰

| **æ‡‰ç”¨å ´æ™¯**     | **å»ºè­°**               |
| ------------ | -------------------- |
| å¤šç‰©ä»¶ã€éœ€é«˜ç²¾åº¦     | ä½¿ç”¨ NMS æˆ–è€ƒæ…®ç”¨ DETR     |
| å³æ™‚æ‡‰ç”¨ï¼Œéœ€å¿«é€Ÿè™•ç†   | ç°¡åŒ–ç‰ˆ NMSï¼ˆTop-k + IoUï¼‰ |
| DETR-like æ¶æ§‹ | å¯å®Œå…¨ç§»é™¤ NMS            |




æˆ‘å°‡ä¾æ“šé€™äº›æ¨¡å‹çš„ **é–‹æºå¯¦ä½œï¼ˆå¦‚ PyTorchã€TensorFlowã€Ultralyticsï¼‰** èˆ‡åŸå§‹è«–æ–‡ï¼Œ**é€ä¸€å›ç­”æ˜¯å¦å…§å»º NMSã€æ˜¯å¦éœ€è¦æ‰‹å‹•è™•ç†**ï¼Œå†ç¸½çµå‡ºå“ªäº›æ¨¡å‹éœ€è¦ä½ è‡ªå·±æ¥ NMSã€‚

---

## âœ… å„æ¨¡å‹ NMS æ˜¯å¦å…§å»ºæ•´ç†è¡¨

|**æ¨¡å‹**|**æ˜¯å¦å…§å»º NMSï¼Ÿ**|**èªªæ˜**|
|---|---|---|
|**YOLO v1â€“v4**|âŒ ä¸å…§å»º|è«–æ–‡èˆ‡å¤§éƒ¨åˆ†å¯¦ä½œä¸­ï¼ŒNMS éœ€è‡ªå·±åŠ åœ¨æ¨ç†å¾Œè™•ç†ï¼Œç¯©é¸é æ¸¬æ¡†|
|**YOLO v5 / v7 / v8 (Ultralytics)**|âœ… å…§å»º|Ultralytics çš„ `model.predict()` é è¨­æœƒè‡ªå‹•åŠ ä¸Š NMS|
|**FCOS**|âŒ ä¸å…§å»º|è¼¸å‡ºç‚º dense é æ¸¬ï¼Œéœ€è‡ªè¡Œåœ¨æ¨ç†å¾ŒåŸ·è¡Œ NMSï¼Œå¦‚ `torchvision.ops.nms()`|
|**EfficientDet (TF, PyTorch)**|âŒ ä¸å…§å»º|å®˜æ–¹èˆ‡ç¬¬ä¸‰æ–¹å¯¦ä½œé€šå¸¸å°‡ NMS ä½œç‚ºå¾Œè™•ç†ï¼Œéœ€è¦æ‰‹å‹•å¥—ç”¨ï¼ˆå¦‚ä½¿ç”¨ `TFLite` ä¹Ÿè¦æ˜ç¢ºåŠ å…¥ï¼‰|
|**MobileNet-SSD (Caffe, PyTorch)**|âŒ ä¸å…§å»º|Caffe å’Œ Torch ç‰ˆæœ¬é€šå¸¸æœƒåœ¨æ¨ç†å¾Œå¤–éƒ¨åŠ  NMSï¼Œå¦‚ MobileNet-SSD with OpenCV DNN|
|**DETR / Deformable DETR**|âœ… ä¸éœ€è¦ NMS|è¨“ç·´éç¨‹ä¸­ä½¿ç”¨ Hungarian Matchingï¼Œè‡ªå‹•é¿å…é‡ç–Šï¼Œä¸éœ€ä½¿ç”¨ä»»ä½•å½¢å¼çš„ NMS|

---

## âœ… å“ªäº›æ¨¡å‹ **éœ€è¦æ‰‹å‹•** åŠ ä¸Š NMSï¼Ÿ

é€™äº›æ¨¡å‹åœ¨æ¨ç†éšæ®µæœƒè¼¸å‡º **å¤§é‡æ¡†ï¼ˆæˆ– dense mapï¼‰**ï¼Œä½ éœ€è¦è‡ªå·±åœ¨å¾Œè™•ç†éšæ®µæ¥ä¸Š NMSï¼š

|æ¨¡å‹|æ‰‹å‹•åŠ  NMSï¼Ÿ|æ¨ç†æ™‚è¼¸å‡ºç‚ºâ€¦|æ¨è–¦ç”¨æ³•|
|---|---|---|---|
|YOLO v1â€“v4|âœ…|Dense bbox list|ç”¨ IoU é–€æª»+Top-k éæ¿¾|
|FCOS|âœ…|æ¯å€‹åƒç´ é»é æ¸¬æ¡†|ç”¨ `torchvision.ops.nms()`|
|EfficientDet|âœ…|æ‰€æœ‰ anchor-based é æ¸¬æ¡†|å¯æ­é… score threshold + NMS|
|MobileNet-SSD|âœ…|Dense é æ¸¬ + é¡åˆ¥åˆ†æ•¸|OpenCV æä¾› `cv2.dnn.NMSBoxes`|
|DETR|âŒ ä¸éœ€è¦|å›ºå®š object queries|ä¸éœ€ NMSï¼Œç›´æ¥è¼¸å‡ºçµæœ|

---

## âœ… å“ªäº›æ¨¡å‹ **å·²å…§å»º NMSï¼Œä¸éœ€è‡ªå·±åŠ ï¼Ÿ**

|æ¨¡å‹|èªªæ˜|
|---|---|
|**YOLOv5~v8 (Ultralytics)**|é è¨­ `model.predict()`ã€`model.forward()`ï¼ˆ`inference=True`ï¼‰éƒ½æœƒè‡ªå‹•åš NMSã€‚è‹¥ä¸æƒ³ä½¿ç”¨ï¼Œå¯åœ¨ `model.forward(inference=False)` ä¸­é—œé–‰ã€‚|
|**DETR / Deformable DETR**|å®Œå…¨ä¸éœ€è¦ï¼Œè¨­è¨ˆä¸Šé¿å…é‡ç–Šé æ¸¬ï¼ˆé€é Matching è¨“ç·´å­¸æœƒï¼‰|





**é€šç”¨ NMS Python ç¨‹å¼ç¢¼**

ä»¥ä¸‹æ˜¯ä¸€å€‹é€šç”¨çš„ NMS å‡½æ•¸ï¼Œæ‚¨å¯ä»¥å°‡å…¶æ‡‰ç”¨æ–¼ä»»ä½•è¼¸å‡ºåŒ…å«é‚Šç•Œæ¡†å’Œç½®ä¿¡åº¦çš„ç›®æ¨™æª¢æ¸¬æ¨¡å‹ã€‚

```Python
import numpy as np

def non_max_suppression(boxes, scores, iou_threshold):
    """
    å°æª¢æ¸¬åˆ°çš„é‚Šç•Œæ¡†åŸ·è¡Œéæ¥µå¤§å€¼æŠ‘åˆ¶ã€‚

    Args:
        boxes (np.ndarray): å½¢ç‹€ç‚º (N, 4) çš„ NumPy é™£åˆ—ï¼Œå…¶ä¸­ N æ˜¯æª¢æ¸¬åˆ°çš„é‚Šç•Œæ¡†æ•¸é‡ã€‚
                           æ¯å€‹æ¡†çš„æ ¼å¼ç‚º (x_min, y_min, x_max, y_max)ã€‚
        scores (np.ndarray): å½¢ç‹€ç‚º (N,) çš„ NumPy é™£åˆ—ï¼ŒåŒ…å«æ¯å€‹æ¡†çš„ç½®ä¿¡åº¦åˆ†æ•¸ã€‚
        iou_threshold (float): IoU (Intersection over Union) é–¾å€¼ï¼Œç”¨æ–¼ç¢ºå®šé‡ç–Šæ¡†ã€‚

    Returns:
        np.ndarray: ä¿ç•™çš„é‚Šç•Œæ¡†çš„ç´¢å¼•ã€‚
    """
    # å¦‚æœæ²’æœ‰æª¢æ¸¬åˆ°æ¡†ï¼Œå‰‡è¿”å›ä¸€å€‹ç©ºåˆ—è¡¨
    if len(boxes) == 0:
        return []

    # å°‡æ¡†çš„åæ¨™è½‰æ›ç‚ºæµ®é»æ•¸
    boxes = boxes.astype(np.float32)

    # ç²å–æŒ‰ç½®ä¿¡åº¦åˆ†æ•¸é™åºæ’åˆ—çš„æ¡†çš„ç´¢å¼•
    indices = np.argsort(scores)[::-1]

    # ç”¨æ–¼å­˜å„²ä¿ç•™çš„æ¡†çš„ç´¢å¼•çš„åˆ—è¡¨
    keep_indices = []

    while indices.size > 0:
        # é¸æ“‡ç½®ä¿¡åº¦æœ€é«˜çš„æ¡†
        current_index = indices[0]
        keep_indices.append(current_index)

        # è¨ˆç®—ç•¶å‰æ¡†èˆ‡å‰©é¤˜æ¡†çš„ IoU
        current_box = boxes[current_index]
        remaining_indices = indices[1:]
        remaining_boxes = boxes[remaining_indices]

        x1 = np.maximum(current_box[0], remaining_boxes[:, 0])
        y1 = np.maximum(current_box[1], remaining_boxes[:, 1])
        x2 = np.minimum(current_box[2], remaining_boxes[:, 2])
        y2 = np.minimum(current_box[3], remaining_boxes[:, 3])

        # è¨ˆç®—äº¤é›†å€åŸŸ
        intersection_area = np.maximum(0, x2 - x1) * np.maximum(0, y2 - y1)

        # è¨ˆç®—æ¯å€‹æ¡†çš„å€åŸŸ
        current_area = (current_box[2] - current_box[0]) * (current_box[3] - current_box[1])
        remaining_areas = (remaining_boxes[:, 2] - remaining_boxes[:, 0]) * (remaining_boxes[:, 3] - remaining_boxes[:, 1])

        # è¨ˆç®— IoU
        iou = intersection_area / (current_area + remaining_areas - intersection_area + 1e-6)

        # ç§»é™¤ IoU å¤§æ–¼é–¾å€¼çš„æ¡†
        indices = remaining_indices[iou <= iou_threshold]

    return np.array(keep_indices)

# ç¤ºä¾‹ç”¨æ³•
if __name__ == '__main__':
    boxes = np.array([[10, 10, 100, 100],
                      [20, 20, 110, 110],
                      [150, 150, 250, 250],
                      [160, 160, 260, 260]])
    scores = np.array([0.9, 0.8, 0.7, 0.6])
    iou_threshold = 0.5
    keep_indices = non_max_suppression(boxes, scores, iou_threshold)
    print("ä¿ç•™çš„æ¡†çš„ç´¢å¼•:", keep_indices)
    print("ä¿ç•™çš„æ¡†:", boxes[keep_indices])
```

**æ¨¡å‹å…§ NMS è¨­å®š**

è¨±å¤šç¾ä»£ç›®æ¨™æª¢æ¸¬æ¨¡å‹éƒ½åœ¨æ¨¡å‹å…§éƒ¨é›†æˆäº† NMSï¼Œä»¥æé«˜æ•ˆç‡ã€‚ä»¥ä¸‹æ˜¯æ‚¨åœ¨ä½¿ç”¨é€™äº›æ¨¡å‹æ™‚å¯èƒ½éœ€è¦é…ç½®çš„ç›¸é—œåƒæ•¸ï¼š

**1. YOLO ç³»åˆ— (YOLOv3, YOLOv5, YOLOv8 ç­‰)**

- **è¨­å®šä½ç½®:** é€šå¸¸åœ¨æ¨¡å‹çš„å¾Œè™•ç†éšæ®µæˆ–æª¢æ¸¬å±¤ä¸­ã€‚
    
- **ä¸»è¦åƒæ•¸:**
    
    - `conf_thres` (æˆ– `confidence_threshold`): ç½®ä¿¡åº¦é–¾å€¼ã€‚åªæœ‰ç½®ä¿¡åº¦é«˜æ–¼æ­¤é–¾å€¼çš„æª¢æ¸¬æ¡†æ‰æœƒè¢«è€ƒæ…®é€²è¡Œ NMSã€‚
    - `iou_thres` (æˆ– `iou_threshold`): IoU é–¾å€¼ã€‚IoU é«˜æ–¼æ­¤é–¾å€¼çš„é‡ç–Šæ¡†å°‡è¢«æŠ‘åˆ¶ã€‚
    - `max_det` (æˆ– `max_predictions`): æ¯å¼µåœ–åƒè¼¸å‡ºçš„æœ€å¤§æª¢æ¸¬æ¡†æ•¸é‡ã€‚å³ä½¿åœ¨ NMS ä¹‹å¾Œï¼Œä¹Ÿåªæœƒä¿ç•™ç½®ä¿¡åº¦æœ€é«˜çš„å‰ `max_det` å€‹æ¡†ã€‚
- **ç¨‹å¼ç¢¼ç¯„ä¾‹ (PyTorch YOLOv5):**
    
    ```Python
    import torch
    
    # è¼‰å…¥æ¨¡å‹
    model = torch.hub.load('ultralytics/yolov5', 'yolov5s', pretrained=True)
    
    # æ¨ç†
    img = 'https://ultralytics.com/images/zidane.jpg'
    results = model(img)
    
    # results.xyxy[0] åŒ…å«æ¯å€‹æª¢æ¸¬åˆ°çš„ç‰©ä»¶çš„ [x_min, y_min, x_max, y_max, confidence, class]
    # NMS å·²ç¶“åœ¨æ¨¡å‹å…§éƒ¨åŸ·è¡Œï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹åƒæ•¸é€²è¡Œèª¿æ•´ï¼š
    
    # èª¿æ•´ç½®ä¿¡åº¦é–¾å€¼
    model.conf = 0.5  # åªä¿ç•™ç½®ä¿¡åº¦ >= 0.5 çš„æª¢æ¸¬æ¡†
    
    # èª¿æ•´ IoU é–¾å€¼
    model.iou = 0.45 # NMS çš„ IoU é–¾å€¼
    
    # èª¿æ•´æœ€å¤§æª¢æ¸¬æ•¸é‡
    model.max_det = 100 # æ¯å¼µåœ–ç‰‡æœ€å¤šä¿ç•™ 100 å€‹æª¢æ¸¬æ¡†
    
    results = model(img)
    print(results.xyxy[0])
    ```
    

**2. FCOS (Fully Convolutional One-Stage Object Detection)**

- **è¨­å®šä½ç½®:** é€šå¸¸åœ¨æ¨¡å‹çš„å¾Œè™•ç†éšæ®µã€‚
    
- **ä¸»è¦åƒæ•¸:**
    
    - `score_thresh`: ç½®ä¿¡åº¦é–¾å€¼ï¼Œèˆ‡ YOLO çš„ `conf_thres` é¡ä¼¼ã€‚
    - `nms_thresh`: IoU é–¾å€¼ï¼Œèˆ‡ YOLO çš„ `iou_thres` é¡ä¼¼ã€‚
    - `detections_per_img`: æ¯å¼µåœ–åƒè¼¸å‡ºçš„æœ€å¤§æª¢æ¸¬æ¡†æ•¸é‡ï¼Œèˆ‡ YOLO çš„ `max_det` é¡ä¼¼ã€‚
- **ç¨‹å¼ç¢¼ç¯„ä¾‹ (ä½¿ç”¨ Detectron2 æ¡†æ¶):**
    
    ```Python
    from detectron2.config import get_cfg
    from detectron2.engine import DefaultPredictor
    import cv2
    
    # è¼‰å…¥ FCOS æ¨¡å‹é…ç½®
    cfg = get_cfg()
    cfg.merge_from_file(
        "detectron2://COCO-Detection/fcos_R_50_FPN_1x.yaml"
    )
    cfg.MODEL.WEIGHTS = "detectron2://COCO-Detection/fcos_R_50_FPN_1x/137038246/model_final_f96b54.pkl"
    cfg.MODEL.ROI_HEADS.SCORE_THRESH_TEST = 0.5  # è¨­å®šç½®ä¿¡åº¦é–¾å€¼
    cfg.MODEL.ROI_HEADS.NMS_THRESH_TEST = 0.45 # è¨­å®š IoU é–¾å€¼
    cfg.MODEL.ROI_HEADS.DETECTIONS_PER_IMAGE = 100 # è¨­å®šæœ€å¤§æª¢æ¸¬æ•¸é‡
    predictor = DefaultPredictor(cfg)
    
    # é€²è¡Œé æ¸¬
    im = cv2.imread("path/to/your/image.jpg")
    outputs = predictor(im)
    print(outputs["instances"].pred_boxes)
    print(outputs["instances"].scores)
    ```
    

**3. EfficientDet**

- **è¨­å®šä½ç½®:** é€šå¸¸åœ¨æ¨¡å‹çš„å¾Œè™•ç†éšæ®µã€‚
    
- **ä¸»è¦åƒæ•¸:**
    
    - `score_threshold`: ç½®ä¿¡åº¦é–¾å€¼ã€‚
    - `iou_threshold`: IoU é–¾å€¼ã€‚
    - `max_detection_points`: æ¯å¼µåœ–åƒçš„æœ€å¤§æª¢æ¸¬æ¡†æ•¸é‡ã€‚
- **ç¨‹å¼ç¢¼ç¯„ä¾‹ (ä½¿ç”¨ `tf.keras` å¯¦ç¾):**
    
    ```Python
    import tensorflow as tf
    from efficientdet import EfficientDetModel
    
    # è¼‰å…¥ EfficientDet æ¨¡å‹
    model = EfficientDetModel(model_name='efficientdet-d0')
    model.load_weights('efficientdet-d0.h5') # è¼‰å…¥é è¨“ç·´æ¬Šé‡
    
    # é€²è¡Œé æ¸¬ (å‡è¨­ä½ å·²ç¶“æœ‰äº†é è™•ç†å¾Œçš„åœ–åƒ `image`)
    predictions = model.predict(image)
    
    # å¾Œè™•ç†å‡½æ•¸é€šå¸¸æœƒåŒ…å« NMS
    # ä½ å¯èƒ½éœ€è¦æŸ¥çœ‹ EfficientDet å¯¦ç¾çš„ç¨‹å¼ç¢¼ä¾†æ‰¾åˆ°å…·é«”çš„åƒæ•¸åç¨±å’Œè¨­å®šæ–¹å¼ã€‚
    # ä¸€äº›å¯¦ç¾å¯èƒ½æœƒå°‡é€™äº›åƒæ•¸ä½œç‚ºå¾Œè™•ç†å‡½æ•¸çš„è¼¸å…¥ã€‚
    
    # ç¯„ä¾‹ (å¯èƒ½éœ€è¦æ ¹æ“šå…·é«”å¯¦ç¾èª¿æ•´):
    # from efficientdet.postprocess import postprocess_boxes
    # detections = postprocess_boxes(predictions[0], image.shape[1], image.shape[2],
    #                                score_threshold=0.5, iou_threshold=0.45,
    #                                max_detection_points=100)
    # print(detections)
    ```
    

**4. MobileNet-SSD**

- **è¨­å®šä½ç½®:** é€šå¸¸åœ¨æ¨¡å‹çš„å¾Œè™•ç†éšæ®µã€‚
    
- **ä¸»è¦åƒæ•¸:**
    
    - `confidence_threshold`: ç½®ä¿¡åº¦é–¾å€¼ã€‚
    - `iou_threshold`: IoU é–¾å€¼ã€‚
    - `top_k`: åœ¨ NMS ä¹‹å‰ä¿ç•™çš„æœ€é«˜ç½®ä¿¡åº¦æ¡†çš„æ•¸é‡ã€‚
- **ç¨‹å¼ç¢¼ç¯„ä¾‹ (ä½¿ç”¨ TensorFlow Object Detection API):**
    
    ```Python
    import tensorflow as tf
    import tensorflow_hub as hub
    
    # è¼‰å…¥ MobileNet-SSD æ¨¡å‹
    module_handle = "https://tfhub.dev/tensorflow/ssd_mobilenet_v2/2"
    detector = hub.load(module_handle)
    
    # é€²è¡Œé æ¸¬ (å‡è¨­ä½ å·²ç¶“æœ‰äº†åœ–åƒ `image_np`)
    detections = detector(image_np)
    
    # åœ¨ TensorFlow Object Detection API ä¸­ï¼ŒNMS é€šå¸¸æ˜¯æ¨¡å‹åœ–çš„ä¸€éƒ¨åˆ†ã€‚
    # ä½ å¯ä»¥åœ¨é…ç½®æª”æ¡ˆ (pipeline.config) ä¸­æ‰¾åˆ°ç›¸é—œçš„ NMS è¨­å®šã€‚
    # å¸¸è¦‹çš„é…ç½®è·¯å¾‘å¯èƒ½é¡ä¼¼æ–¼ï¼š
    # model {
    #   ssd {
    #     post_processing {
    #       batch_non_max_suppression {
    #         score_threshold: 0.5
    #         iou_threshold: 0.45
    #         max_detections_per_class: 100
    #         max_total_detections: 100
    #       }
    #     }
    #   }
    # }
    
    # è¦åœ¨ç¨‹å¼ç¢¼ä¸­èª¿æ•´é€™äº›åƒæ•¸ï¼Œä½ é€šå¸¸éœ€è¦ä¿®æ”¹é…ç½®æª”æ¡ˆä¸¦é‡æ–°è¨“ç·´æˆ–ä½¿ç”¨æä¾›çš„å·¥å…·é€²è¡Œé…ç½®ã€‚
    # ç›´æ¥åœ¨æ¨ç†æ™‚æ›´æ”¹é€™äº›å…§éƒ¨ NMS åƒæ•¸å¯èƒ½æ¯”è¼ƒè¤‡é›œã€‚
    ```
    

**5. Faster R-CNN å’Œ Mask R-CNN**

- **è¨­å®šä½ç½®:** é€šå¸¸åœ¨æ¨¡å‹çš„ RoI (Region of Interest) å¾Œè™•ç†éšæ®µã€‚
    
- **ä¸»è¦åƒæ•¸:**
    
    - `score_thresh`: ç”¨æ–¼éæ¿¾ä½ç½®ä¿¡åº¦ RoI çš„é–¾å€¼ã€‚
    - `nms_thresh`: ç”¨æ–¼å°æ¯å€‹é¡åˆ¥çš„ RoI åŸ·è¡Œ NMS çš„ IoU é–¾å€¼ã€‚
    - `detections_per_img`: æ¯å¼µåœ–åƒè¼¸å‡ºçš„æœ€å¤§æª¢æ¸¬æ¡†æ•¸é‡ã€‚
- **ç¨‹å¼ç¢¼ç¯„ä¾‹ (ä½¿ç”¨ Detectron2 æ¡†æ¶ - èˆ‡ FCOS é¡ä¼¼):**
    
    ```Python
    from detectron2.config import get_cfg
    from detectron2.engine import DefaultPredictor
    import cv2
    
    # è¼‰å…¥ Faster R-CNN æˆ– Mask R-CNN æ¨¡å‹é…ç½®
    # ä¾‹å¦‚ Faster R-CNN:
    cfg = get_cfg()
    cfg.merge_from_file(
        "detectron2://COCO-Detection/faster_rcnn_R_50_FPN_1x.yaml"
    )
    cfg.MODEL.WEIGHTS = "detectron2://COCO-Detection/faster_rcnn_R_50_FPN_1x/137257794/model_final_b27c81.pkl"
    cfg.MODEL.ROI_HEADS.SCORE_THRESH_TEST = 0.5  # è¨­å®šç½®ä¿¡åº¦é–¾å€¼
    cfg.MODEL.ROI_HEADS.NMS_THRESH_TEST = 0.45 # è¨­å®š IoU é–¾å€¼
    cfg.MODEL.ROI_HEADS.DETECTIONS_PER_IMAGE = 100 # è¨­å®šæœ€å¤§æª¢æ¸¬æ•¸é‡
    predictor = DefaultPredictor(cfg)
    
    # æˆ–è€… Mask R-CNN:
    cfg = get_cfg()
    cfg.merge_from_file(
        "detectron2://COCO-InstanceSegmentation/mask_rcnn_R_50_FPN_1x.yaml"
    )
    cfg.MODEL.WEIGHTS = "detectron2://COCO-InstanceSegmentation/mask_rcnn_R_50_FPN_1x/137259228/model_final_b83cb5.pkl"
    cfg.MODEL.ROI_HEADS.SCORE_THRESH_TEST = 0.5
    cfg.MODEL.ROI_HEADS.NMS_THRESH_TEST = 0.45
    cfg.MODEL.ROI_HEADS.DETECTIONS_PER_IMAGE = 100
    predictor = DefaultPredictor(cfg)
    
    # é€²è¡Œé æ¸¬
    im = cv2.imread("path/to/your/image.jpg")
    outputs = predictor(im)
    print(outputs["instances"].pred_boxes)
    print(outputs["instances"].scores)
    if "pred_masks" in outputs["instances"]:
        print(outputs["instances"].pred_masks)
    ```
    

**ç¸½çµ**

- å°æ–¼é€šç”¨çš„ NMS éœ€æ±‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æä¾›çš„ Python ç¨‹å¼ç¢¼ã€‚
- å°æ–¼æ¨¡å‹å…§éƒ¨çš„ NMSï¼Œåƒæ•¸åç¨±é€šå¸¸åŒ…æ‹¬ `score_thresh` (æˆ– `confidence_threshold`) å’Œ `iou_thresh` (æˆ– `iou_threshold`)ï¼Œä»¥åŠé™åˆ¶è¼¸å‡ºæ•¸é‡çš„åƒæ•¸ (å¦‚ `max_det` æˆ– `detections_per_img`)ã€‚
- å…·é«”çš„åƒæ•¸åç¨±å’Œè¨­å®šæ–¹å¼å–æ±ºæ–¼æ‚¨ä½¿ç”¨çš„æ¨¡å‹æ¡†æ¶ (å¦‚ PyTorch, TensorFlow, Detectron2 ç­‰)ã€‚è«‹åƒè€ƒæ‚¨æ‰€ç”¨æ¡†æ¶å’Œæ¨¡å‹çš„å®˜æ–¹æ–‡æª”æˆ–ç¨‹å¼ç¢¼ä¾†é€²è¡Œæ›´ç²¾ç¢ºçš„é…ç½®ã€‚